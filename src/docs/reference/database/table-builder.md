# Table builder

O table builder permite que voc√™ **crie**, **remova** ou **renomeie** colunas em uma tabela de banco de dados selecionada.

Voc√™ obt√©m acesso √† inst√¢ncia do table builder chamando um dos seguintes m√©todos do schema builder.

```ts {3-9}
class UserSchema extends BaseSchema {
  public up() {
    this.schema.createTable('users', (table) => {
      console.log(table) // üëà Table builder
    })

    this.schema.table('users', (table) => {
      console.log(table) // üëà Table builder
    })
  }
}
```

## M√©todos/Propriedades
A seguir est√° a lista de m√©todos/propriedades dispon√≠veis na classe table builder.

### `dropColumn`
Remova uma coluna pelo seu nome.

```ts
this.schema.table('users', (table) => {
  table.dropColumn('name')
})
```

### `dropColumns`
Remova mais de uma coluna fornecendo v√°rios argumentos.

```ts
this.schema.table('users', (table) => {
  table.dropColumns('first_name', 'last_name')
})
```

### `renameColumn`
Renomeie uma coluna. O m√©todo aceita o nome da coluna existente como o primeiro argumento e o novo nome como o segundo argumento.

```ts
this.schema.table('users', (table) => {
  table.renameColumn('name', 'full_name')
})
```

### `increments`

Adiciona uma coluna de incremento autom√°tico. A coluna tamb√©m √© marcada como a chave prim√°ria, a menos que seja desabilitada explicitamente.

- No PostgreSQL, a coluna tem o tipo de dados `serial`.
- No Amazon Redshift, √© um `integer indentity (1,1)`.

```ts
this.schema.createTable('users', (table) => {
  table.increments('id')
})
```

Defina uma coluna de incremento, mas n√£o a marque como a chave prim√°ria.

```ts
this.schema.createTable('users', (table) => {
  table.increments('other_id', { primaryKey: false })
})
```

### `integer`

Adicione uma coluna de inteiro.

```ts
this.schema.createTable('users', (table) => {
  table.integer('visits')
})
```

### `bigInteger`
Adiciona uma coluna `bigint` no MYSQL e PostgreSQL. Para todos os outros drivers de banco de dados, o padr√£o √© um inteiro normal.

::: info NOTA
Os valores da coluna BigInt s√£o retornados como uma string nos resultados da consulta.
:::

```ts
this.schema.createTable('users', (table) => {
  table.bigInteger('visits')
})
```

### `text`

Adiciona uma coluna de texto ao banco de dados. Voc√™ pode definir opcionalmente o tipo de dados de texto como `mediumtext` ou `longtext`. O tipo de dados √© ignorado se o driver subjacente n√£o for MySQL.

```ts
this.schema.createTable('posts', (table) => {
  table.text('content_markdown', 'longtext')
})
```

### `string`

Adiciona uma coluna de string com um comprimento opcional. O comprimento padr√£o √© `255`, se n√£o for especificado.

```ts
this.schema.createTable('posts', (table) => {
  table.string('title')

  // Comprimento expl√≠cito
  table.string('title', 100)
})
```

### `float`

Adiciona uma coluna float, com **precis√£o opcional (padr√£o 8)** e **escala (padr√£o 2)**.

```ts
this.schema.createTable('products', (table) => {
  table.float('price')

  /**
   * Precis√£o e escala expl√≠citas
   */
  table.float('price', 8, 2)
})
```

### `decimal`

Adiciona uma coluna decimal, com **precis√£o opcional (padr√£o 8)** e **escala (padr√£o 2)**.

Especificar `null` como precis√£o cria uma coluna decimal que pode armazenar n√∫meros de precis√£o e escala. (Suportado apenas para Oracle, SQLite, Postgres)

```ts
this.schema.createTable('products', (table) => {
  table.decimal('price')

  /**
   * Precis√£o e escala expl√≠citas
   */
  table.decimal('price', 8, 2)
})
```

### `boolean`

Adiciona uma coluna booleana. Muitos bancos de dados representam `true` e `false` como `1` e `0` e retornam o mesmo valor durante consultas SQL.

```ts
this.schema.createTable('posts', (table) => {
  table.boolean('is_published')
})
```

### `date`
Adiciona uma coluna de data √† tabela do banco de dados.

```ts
this.schema.createTable('users', (table) => {
  table.date('dob')
})
```

### `dateTime`
Adiciona uma coluna DateTime √† tabela do banco de dados. O m√©todo aceita o nome da coluna como o primeiro argumento, juntamente com o objeto de op√ß√µes para configurar a `precis√£o` e usar o tipo de dados `timestampz`.

- Voc√™ pode habilitar/desabilitar o tipo de dados `timestampz` para PostgreSQL. Ele √© habilitado por padr√£o.
- Voc√™ pode definir a precis√£o da coluna para **MySQL 5.6+**.

```ts
this.schema.createTable('users', (table) => {
  table
    .dateTime('some_time', { useTz: true })
    .defaultTo(this.now())

  // Ou defina a precis√£o
  table
    .dateTime('some_time', { precision: 6 })
    .defaultTo(this.now(6))
})
```

### `time`
Adiciona uma coluna de tempo com precis√£o opcional para MySQL. N√£o √© compat√≠vel com Amazon Redshift.

```ts
this.schema.createTable('users', (table) => {
  table.time('some_time', { precision: 6 })
})
```

### `timestamp`
Adiciona uma coluna de registro de data e hora √† tabela do banco de dados. O m√©todo aceita o nome da coluna como o primeiro argumento, juntamente com o objeto de op√ß√µes para configurar a `precis√£o` e usar o tipo de dados `timestampz`.

- Voc√™ pode habilitar/desabilitar o tipo de dados `timestampz` para PostgreSQL. Ele √© habilitado por padr√£o.
- Definir `useTz = true` usar√° o tipo de dados `DATETIME2` para MSSQL. Ele √© desabilitado por padr√£o.
- Voc√™ pode definir a precis√£o da coluna para **MySQL 5.6+**.

```ts
this.schema.createTable('users', (table) => {
  table.timestamp('created_at')

  // Habilite timestampz e DATETIME2 para MSSQL
  table.timestamp('created_at', { useTz: true })

  // Use precis√£o com MySQL
  table.timestamp('created_at', { precision: 6 })
})
```

### `timestamps`
Adiciona colunas `created_at` e `updated_at` √† tabela do banco de dados.

::: warning ATEN√á√ÉO
Como o AdonisJS usa o Knex.js por baixo dos panos, o recurso de preenchimento autom√°tico do seu editor listar√° o m√©todo `timestamps` na lista de m√©todos dispon√≠veis.

No entanto, recomendamos n√£o usar esse m√©todo e, em vez disso, usar o m√©todo `timestamp` pelos seguintes motivos.

- O m√©todo `timestamps` n√£o √© encade√°vel. O que significa que voc√™ n√£o pode adicionar restri√ß√µes adicionais como `index` ou `nullable` √† coluna.
- Voc√™ pode criar colunas do tipo `timestampz` ou `Datetime2`.
:::

```ts
this.schema.createTable('users', (table) => {
  table.timestamps()
})
```

Por padr√£o, o m√©todo `timestamps` cria uma coluna **DATETIME**. No entanto, voc√™ pode alter√°-la para uma coluna **TIMESTAMP** passando `true` como o primeiro argumento.

```ts
this.schema.createTable('users', (table) => {
  /**
   * Cria coluna de timestamp
   */
  table.timestamps(true)
})
```

```ts
this.schema.createTable('users', (table) => {
  /**
   * Cria coluna de timestamp
   * +
   * Defina o valor padr√£o para "CURRENT_TIMESTAMP"
   */
  table.timestamps(true, true)
})
```

### `binary`
Adiciona uma coluna bin√°ria. O m√©todo aceita o nome da coluna como o primeiro argumento, com um comprimento opcional como o segundo argumento (aplic√°vel somente para MySQL).

```ts
this.schema.createTable('users', (table) => {
  table.binary('binary_column')
})
```

### `enum` / `enu`

Adiciona uma coluna enum ao banco de dados. O m√©todo aceita o nome da coluna como o primeiro argumento, uma matriz de op√ß√µes enum como o segundo argumento e um objeto opcional de op√ß√µes como o terceiro argumento.

- No PostgreSQL, voc√™ pode usar o tipo enum nativo definindo o valor `options.useNative` como true. Al√©m disso, certifique-se de fornecer um nome enum exclusivo via `options.enumName`.
- No PostgreSQL, criaremos o enum antes da coluna. Se o tipo enum j√° existir, voc√™ dever√° definir `options.existingType` como true.
- No Amazon Redshift, o tipo de dados varchar(255) n√£o verificado √© usado.

```ts
this.schema.createTable('users', (table) => {
  table.enu('account_status', ['PENDING', 'ACTIVE', 'SUSPENDED'], {
    useNative: true,
    enumName: 'user_account_status',
    existingType: false,
  })
})
```

Voc√™ tamb√©m pode especificar o esquema PostgreSQL para o tipo enum.

```ts
table.enu('account_status', ['PENDING', 'ACTIVE', 'SUSPENDED'], {
    useNative: true,
    enumName: 'user_account_status',
    existingType: false,
    schemaName: 'public' // üëà
  })
```

Certifique-se de remover o enum ao remover a tabela.

```ts
this.schema.raw('DROP TYPE IF EXISTS "user_account_status"')
this.schema.dropTable('users')
```

### `json`
Adiciona uma coluna JSON, usando o tipo JSON integrado no **PostgreSQL**, **MySQL** e **SQLite**, assumindo como padr√£o uma coluna de texto em vers√µes mais antigas ou em bancos de dados n√£o suportados.

```ts
this.schema.createTable('projects', (table) => {
  table.json('settings')
})
```

### `jsonb`
O mesmo que o m√©todo `json`, mas usa o tipo de dados `jsonb` nativo (se poss√≠vel).

```ts
this.schema.createTable('projects', (table) => {
  table.jsonb('settings')
})
```

### `uuid`
Adiciona uma coluna UUID. O m√©todo aceita o nome da coluna como o √∫nico argumento.

- Usa o tipo UUID integrado no PostgreSQL
- Usa `char(36)` para todos os outros bancos de dados

```ts
this.schema.createTable('users', (table) => {
  table.uuid('user_id')
})
```

Certifique-se tamb√©m de criar a extens√£o UUID para o PostgreSQL. Voc√™ tamb√©m pode fazer isso dentro de um arquivo de migra√ß√£o dedicado da seguinte forma:

```ts
import BaseSchema from '@ioc:Adonis/Lucid/Schema'

export default class SetupExtensions extends BaseSchema {
  public up() {
    this.schema.raw('CREATE EXTENSION IF NOT EXISTS "uuid-ossp"')
  }

  public down() {
    this.schema.raw('DROP EXTENSION IF EXISTS "uuid-ossp"')
  }
}
```

### `comment`
Define o coment√°rio para a tabela. Aceita o valor do coment√°rio como o √∫nico argumento.

```ts
this.schema.createTable('users', (table) => {
  table.comment('Manages the app users')
})
```

### `engine`

Define o mecanismo para a tabela do banco de dados. O m√©todo aceita o nome do mecanismo como o √∫nico argumento.

- O m√©todo s√≥ est√° dispon√≠vel em uma chamada `createTable`.
- O mecanismo √© aplic√°vel apenas ao **MySQL** e ignorado para outros bancos de dados.

```ts
this.schema.createTable('users', (table) => {
  table.engine('MyISAM')
})
```

### `charset`

Define o conjunto de caracteres para a tabela do banco de dados. O m√©todo aceita o valor charset como o √∫nico argumento.

- O m√©todo s√≥ est√° dispon√≠vel em uma chamada `createTable`.
- O charset s√≥ √© aplic√°vel ao **MySQL** e ignorado para outros bancos de dados.

```ts
this.schema.createTable('users', (table) => {
  table.charset('utf8')
})
```

### `collate`

Define a ordena√ß√£o para a tabela do banco de dados. O m√©todo aceita o valor da ordena√ß√£o como o √∫nico argumento.

- O m√©todo s√≥ est√° dispon√≠vel em uma chamada `createTable`.
- A ordena√ß√£o √© aplic√°vel apenas ao **MySQL** e ignorada para outros bancos de dados.

```ts
this.schema.createTable('users', (table) => {
  table.collate('utf8_unicode_ci')
})
```

### `inherits`
Define a tabela pai para heran√ßa. O m√©todo aceita o nome da tabela pai como o √∫nico argumento.

- O m√©todo s√≥ est√° dispon√≠vel em uma chamada `createTable`.
- `inherits` √© aplic√°vel apenas ao **PostgreSQL** e ignorado para outros bancos de dados.

```ts
this.schema.createTable('capitals', (table) => {
  table.inherits('cities')
})
```

### `specificType`
Cria uma coluna definindo seu tipo como uma string bruta. O m√©todo permite que voc√™ crie uma coluna de banco de dados, que n√£o √© coberta pela API padr√£o do construtor de tabelas.

O primeiro argumento √© o nome da coluna, e o segundo argumento √© o tipo de coluna.

```ts
this.schema.createTable('users', (table) => {
  table.specificType('mac_address', 'macaddr')
})
```

### `index`
Adiciona um √≠ndice a uma tabela sobre as colunas fornecidas. Voc√™ deve criar a tabela antes de definir o √≠ndice.

- O m√©todo aceita uma matriz de colunas como o primeiro argumento.
- Um nome de √≠ndice opcional como o segundo argumento
- E um tipo de √≠ndice opcional como o terceiro argumento. O tipo de √≠ndice √© aplic√°vel apenas para bancos de dados PostgreSQL e MySQL.

```ts
this.schema.alterTable('users', (table) => {
  table.index(['first_name', 'last_name'], 'user_name_index')
})
```

### `dropIndex`

Remove um √≠ndice existente das colunas da tabela. O m√©todo aceita colunas como o primeiro argumento e um nome de √≠ndice opcional como o segundo argumento.

```ts
this.schema.alterTable('users', (table) => {
  table.dropIndex(['first_name', 'last_name'], 'user_name_index')
})
```

### `unique`

Adiciona um √≠ndice exclusivo a uma tabela sobre as colunas fornecidas. Um nome de √≠ndice padr√£o usando as colunas √© usado, a menos que `indexName` seja especificado.

```ts
this.schema.alterTable('posts', (table) => {
  table.unique(['slug', 'tenant_id'])
})
```

### `foreign`

Adiciona uma restri√ß√£o de chave estrangeira a uma tabela para colunas existentes. Certifique-se de que a tabela j√° exista ao usar o m√©todo `foreign`.

- Os m√©todos um ou mais nomes de coluna como o primeiro argumento.
- Voc√™ pode definir um `foreignKeyName` personalizado como o segundo argumento. Se n√£o for especificado, os nomes das colunas ser√£o usados ‚Äã‚Äãpara ger√°-lo.

```ts
this.schema.alterTable('posts', (table) => {
  table.foreign('user_id').references('users.id')
})
```

Voc√™ tamb√©m pode encadear os m√©todos `onDelete` e `onUpdate` para definir os gatilhos.

```ts
table
  .foreign('user_id')
  .references('users.id')
  .onDelete('CASCADE')
```

### `dropForeign`
Remove uma restri√ß√£o de chave estrangeira preexistente. O m√©todo aceita uma ou mais colunas como o primeiro argumento e um nome de chave estrangeira opcional como o segundo argumento.

```ts
this.schema.alterTable('posts', (table) => {
  table.dropForeign('user_id')
})
```

### `dropUnique`
Remove um √≠ndice exclusivo preexistente. O m√©todo aceita uma matriz de string(s) representando nomes de colunas como o primeiro argumento e um nome de √≠ndice opcional como o segundo argumento.

```ts
this.schema.alterTable('posts', (table) => {
  table.dropUnique(['email'])
})
```

### `dropPrimary`
Remove uma restri√ß√£o de chave prim√°ria preexistente. O m√©todo aceita um nome de restri√ß√£o opcional (o padr√£o √© `tablename_pkey`).

```ts
this.schema.alterTable('posts', (table) => {
  table.dropPrimary()
})
```

### `setNullable`
Define a coluna para ser anul√°vel.

```ts
this.schema.alterTable('posts', (table) => {
  table.setNullable('full_name')
})
```

### `dropNullable`
Remove a restri√ß√£o anul√°vel da coluna.

::: warning ATEN√á√ÉO
A opera√ß√£o falhar√° quando a coluna j√° tiver valores nulos.
:::

```ts
this.schema.alterTable('posts', (table) => {
  table.dropNullable('full_name')
})
```

## M√©todos encade√°veis

A seguir est√° a lista de m√©todos que voc√™ pode encadear nos m√©todos de constru√ß√£o de esquema como modificadores da coluna.

### `alter`

Marca a coluna como um alters/modify em vez do add padr√£o. O m√©todo n√£o √© suportado pelos drivers SQLite ou Amazon Redshift.

::: info NOTA
A instru√ß√£o alter n√£o √© incremental. Voc√™ deve redefinir as restri√ß√µes que deseja aplicar √† coluna.
:::

```ts
this.schema.alterTable('posts', (table) => {
  // elimina a restri√ß√£o NOT NULL e o valor padr√£o (se aplicado anteriormente)
  table.integer('age').alter()
})
```

### `index`

Defina um √≠ndice para a coluna atual. O m√©todo aceita os dois argumentos opcionais a seguir.

- Um nome de √≠ndice opcional como o primeiro argumento.
- E um tipo de √≠ndice opcional como o segundo argumento. O tipo de √≠ndice √© aplic√°vel somente para bancos de dados PostgreSQL e MySQL.

```ts
this.schema.table('posts', (table) => {
  table.string('slug').index('posts_slug')
})
```

### `primary`

Marque a coluna atual como a chave prim√°ria. Opcionalmente, voc√™ pode definir o nome da restri√ß√£o como o primeiro argumento.

No Amazon Redshift, todas as colunas inclu√≠das em uma chave prim√°ria n√£o devem ser anul√°veis.

```ts
this.schema.table('posts', (table) => {
  table.integer('id').primary()
})
```

Se voc√™ quiser definir uma chave prim√°ria composta, dever√° usar o m√©todo `table.primary`.

```ts
this.schema.table('posts', (table) => {
  table.primary(['slug', 'tenant_id'])
})
```

### `unique`
Marque a coluna atual como exclusiva. No Amazon Redshift, essa restri√ß√£o n√£o √© imposta, mas o planejador de consultas a usa.

```ts
this.schema.table('users', (table) => {
  table.string('email').unique()
})
```

### `references`
Defina a coluna que a coluna atual referencia como uma chave estrangeira.

```ts
this.schema.table('posts', (table) => {
  table.integer('user_id').references('id').inTable('users')
})
```

Voc√™ tamb√©m pode definir `tableName.columnName` junto e remover o m√©todo `inTable` completamente.

```ts
this.schema.table('posts', (table) => {
  table.integer('user_id').references('users.id')
})
```

### `inTable`
Defina a tabela para a coluna referenciada pela chave estrangeira.

```ts
this.schema.table('posts', (table) => {
  table.integer('user_id').references('id').inTable('users')
})
```

### `onDelete`
Defina o comando `onDelete` para a chave estrangeira. O comando √© expresso como um valor de string.

```ts
this.schema.table('posts', (table) => {
  table
    .integer('user_id')
    .references('id')
    .inTable('users')
    .onDelete('CASCADE')
})
```

### `onUpdate`
Defina o comando `onUpdate` para a chave estrangeira. O comando √© expresso como um valor de string.

```ts
this.schema.table('posts', (table) => {
  table
    .integer('user_id')
    .references('id')
    .inTable('users')
    .onUpdate('RESTRICT')
})
```

### `defaultTo`
Defina o valor padr√£o para a coluna a ser usada durante a inser√ß√£o.

No MSSQL, uma op√ß√£o constraintName pode ser passada para garantir um nome de restri√ß√£o espec√≠fico:

```ts
this.schema.table('posts', (table) => {
  table.boolean('is_published').defaultTo(false)
  
  // Para MSSQL
  table
    .boolean('is_published')
    .defaultTo(false, { constraintName: 'df_table_value' })
})
```

### `unsigned`
Marque a coluna atual como n√£o assinada.

```ts
this.schema.table('posts', (table) => {
  table
    .integer('user_id')
    .unsigned() // üëà
    .references('id')
    .inTable('users')
})
```

### `notNullable`
Marque a coluna atual como N√ÉO anul√°vel.

::: info NOTA
Considere usar o m√©todo [dropNullable](#dropnullable) ao alterar a coluna.
:::

```ts
this.schema.table('users', (table) => {
  table.integer('email').notNullable()
})
```

### `nullable`
Marque a coluna atual como anul√°vel.

::: info NOTA
Considere usar o m√©todo [setNullable](#setnullable) ao alterar a coluna.
:::

```ts
this.schema.table('users', (table) => {
  table.text('bio').nullable()
})
```

### `first`
Define a coluna a ser inserida na primeira posi√ß√£o, usada somente em tabelas de altera√ß√£o do MySQL.

```ts
this.schema.alterTable('users', (table) => {
  table.string('email').first()
})
```

### `after`
Define a coluna a ser inserida ap√≥s a outra, usada somente em tabelas de altera√ß√£o do MySQL.

```ts
this.schema.alterTable('users', (table) => {
  table.string('avatar_url').after('password')
})
```

### `comment`
Define o coment√°rio para uma coluna

```ts
this.schema.alterTable('users', (table) => {
  table.string('avatar_url').comment('Only relative names are stored')
})
```

### `collate`
Define a ordena√ß√£o para uma coluna (funciona somente no MySQL).

```ts
this.schema.alterTable('users', (table) => {
  table
    .string('email')
    .unique()
    .collate('utf8_unicode_ci')
})
```
