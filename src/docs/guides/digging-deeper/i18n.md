# Internacionaliza√ß√£o

O pacote oficial `@adonisjs/i18n` adiciona suporte para [internacionaliza√ß√£o e localiza√ß√£o](https://en.wikipedia.org/wiki/Internationalization_and_localization) aos seus aplicativos AdonisJS.

- Os auxiliares de internacionaliza√ß√£o permitem que voc√™ execute formata√ß√£o sens√≠vel ao idioma de valores espec√≠ficos, como **data, moeda e nome**.
- A camada de localiza√ß√£o permite que voc√™ armazene tradu√ß√µes e fa√ßa refer√™ncia a elas dentro dos modelos Edge, erros de valida√ß√£o, exce√ß√µes de autentica√ß√£o e assim por diante.

O pacote I18n (abrevia√ß√£o de Internacionaliza√ß√£o) deve ser instalado e configurado separadamente.

:::code-group

```sh [Instale]
npm i @adonisjs/i18n@1.6.0
```

```sh [Configure]
node ace configure @adonisjs/i18n

# CREATE: app/Middleware/DetectUserLocale.ts
# CREATE: ./resources/lang
# CREATE: config/i18n.ts
# UPDATE: .adonisrc.json { providers += "@adonisjs/i18n" }
```

:::

- Auxiliares para executar formata√ß√£o sens√≠vel ao idioma para datas, moedas, nomes e assim por diante.
[Formato de mensagens ICU](https://format-message.github.io/icu-message-format-for-translators/index.html).
- Adicione seu formatador de mensagens personalizado e carregador de tradu√ß√µes.

&nbsp;

[Ver no npm](https://npm.im/@adonisjs/i18n)
[Ver no GitHub](https://github.com/adonisjs/i18n)
[Refer√™ncia de API](../../reference/i18n/i18n-manager.md)

## Uso
A seguir est√° um exemplo b√°sico de importa√ß√£o do pacote instalado e valores de formata√ß√£o.

::: info NOTA
O m√©todo `I18n.locale` retorna uma inst√¢ncia da classe [I18n](https://github.com/adonisjs/i18n/blob/develop/src/I18n/index.ts) para uma localidade espec√≠fica. O c√≥digo de localidade deve ser um c√≥digo de idioma padr√£o [ISO 639-1](https://www.andiamo.co.uk/resources/iso-language-codes/) v√°lido.
:::

```ts
import I18n from '@ioc:Adonis/Addons/I18n'

I18n.locale('en-US').formatDate(new Date())
// 10/8/2021

I18n.locale('fr').formatCurrency(100, { currency: 'EUR' })
// 100,00¬†‚Ç¨

const luxonDate = DateTime.local().minus({ minutes: 10 })
I18n.locale('pt').formatRelativeTime(luxonDate, 'auto')
// h√° 10 minutos
```

Voc√™ pode usar o m√©todo `formatMessage` para formatar tradu√ß√µes armazenadas. O m√©todo aceita a chave da mensagem como o primeiro argumento e os dados como o segundo argumento.

```ts
import I18n from '@ioc:Adonis/Addons/I18n'

I18n
  .locale('en-US')
  .formatMessage('messages.greeting', { name: 'Virk' })
```

Saiba mais sobre [formata√ß√£o de tradu√ß√µes ‚Üí](#formatting-translations)

### Uso durante solicita√ß√µes HTTP
√â recomend√°vel usar o objeto `ctx.i18n` durante as solicita√ß√µes HTTP. √â uma inst√¢ncia isolada da classe [I18n](https://github.com/adonisjs/i18n/blob/develop/src/I18n/index.ts) para a solicita√ß√£o atual.

```ts
Route.get('/', async ({ i18n }) => {
  return i18n.formatCurrency(100, { currency: 'EUR' })
})
```

Por padr√£o, a localidade de `ctx.i18n` √© definida como a localidade padr√£o do aplicativo. Portanto, √© recomend√°vel usar o middleware [DetectUserLocale](#detecting-user-locale) para encontrar a localidade do usu√°rio e atualiz√°-la para o restante da solicita√ß√£o.

## Config
A configura√ß√£o √© armazenada dentro do arquivo `config/i18n.ts`. Voc√™ sempre pode encontrar o [config stub atualizado no GitHub](https://git.io/Jw53K).

```ts
import Application from '@ioc:Adonis/Core/Application'
import { I18nConfig } from '@ioc:Adonis/Addons/I18n'

const i18nConfig: I18nConfig = {
  translationsFormat: 'icu',
  defaultLocale: 'en',

  // Opcional
  supportedLocales: [],
  fallbackLocales: {},

  provideValidatorMessages: true,
  loaders: {
    fs: {
      enabled: true,
      location: Application.resourcesPath('lang'),
    },
  },
}

export default i18nConfig
```

#### `translationsFormat`
O formato a ser usado para formatar tradu√ß√µes. Oficialmente, apenas o [formato de mensagens ICU](https://format-message.github.io/icu-message-format-for-translators/index.html) √© suportado.

#### `defaultLocale`
O `defaultLocale` √© o idioma padr√£o do seu aplicativo. Ele √© sempre est√°tico e n√£o pode ser alterado em tempo de execu√ß√£o. N√≥s procuramos tradu√ß√µes do local padr√£o quando o idioma do usu√°rio atual n√£o √© suportado e, tamb√©m, n√£o h√° fallback dispon√≠vel.

```ts
const i18nConfig: I18nConfig = {
  defaultLocale: 'en'
}
```

#### `supportedLocales`
√â uma matriz de c√≥digos de idioma formatados ISO 639-1 que seu aplicativo suporta. Se o idioma do usu√°rio n√£o for mencionado dentro deste array, usaremos o `defaultLocale` para procurar tradu√ß√µes.

Voc√™ pode opcionalmente definir o `supportedLocales` dentro do arquivo de configura√ß√£o. Caso contr√°rio, inferiremos os locais suportados dos diret√≥rios de idiomas que voc√™ criou dentro do diret√≥rio `resources/lang`.

```ts
const i18nConfig: I18nConfig = {
  supportedLocales: ['fr', 'en', 'it']
}
```

#### `fallbackLocales`
O `fallbackLocales` √© um par de chave-valor dos locais que seu aplicativo suporta junto com seus locais de fallback.

Por exemplo: usar o espanhol como fallback para o idioma catal√£o faz mais sentido do que usar o ingl√™s. Portanto, voc√™ mesmo pode definir os locais de fallback.

::: info NOTA
O local para o qual voc√™ definiu o fallback deve fazer parte do array `supportedLocales`.
:::

```ts
const i18nConfig: I18nConfig = {
  fallbackLocales: {
    ca: 'es'
  }
}
```

#### `provideValidatorMessages`
Habilite/desabilite o suporte para fornecer mensagens de valida√ß√£o por meio de arquivos de tradu√ß√£o. As mensagens s√£o fornecidas quando o sinalizador √© definido como `true`.

Saiba mais sobre [traduzir mensagens de valida√ß√£o](#validator-messages).

#### `loaders`
Os `loaders` s√£o usados ‚Äã‚Äãpara carregar mensagens de algum tipo de armazenamento. Oficialmente, enviamos com uma implementa√ß√£o do carregador `fs` que carrega arquivos `.json` ou `.yaml` do sistema de arquivos.

## Correspond√™ncia de localidade
Permitimos que voc√™ defina tradu√ß√µes para uma regi√£o espec√≠fica ou use um c√≥digo de idioma de dois d√≠gitos para suporte gen√©rico.

Por exemplo: se voc√™ armazenar as tradu√ß√µes para o idioma franc√™s dentro do diret√≥rio `fr`, todas as varia√ß√µes do idioma franc√™s ver√£o as mesmas mensagens.

No entanto, se voc√™ criar diret√≥rios espec√≠ficos da regi√£o, como `fr-ca` ou `fr-ch`, as tradu√ß√µes do melhor local correspondente ser√£o servidas.

O estilo de correspond√™ncia de localidade √© conhecido como negocia√ß√£o de conte√∫do. Em vez de procurar a correspond√™ncia exata, negociamos a correspond√™ncia mais pr√≥xima.

### Encontrando o melhor local correspondente
Voc√™ deve usar o m√©todo `I18n.getSupportedLocale` para encontrar o melhor local para o idioma do usu√°rio.

O m√©todo aceita uma string ou uma matriz de idiomas do usu√°rio e retorna o local correspondente suportado pelo seu aplicativo. `null` √© retornado quando nenhuma correspond√™ncia √© encontrada.

```ts
import I18n from '@ioc:Adonis/Addons/I18n'

const userLanguage = 'en-US'
const bestMatch = I18n.getSupportedLocale(userLanguage)

if (bestMatch) {
  I18n.locale(bestMatch).formatMessage()
} else {
  I18n.locale(I18n.defaultLocale).formatMessage()
}
```

### Detectando a localidade do usu√°rio
Voc√™ deve usar o middleware `DetectUserLocale` armazenado dentro do diret√≥rio `app/Middleware` para encontrar a localidade para a solicita√ß√£o HTTP de entrada.

Por padr√£o, o middleware usa o cabe√ßalho HTTP [Accept-language](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Language) para encontrar o idioma do navegador do usu√°rio.

No entanto, voc√™ pode alterar a implementa√ß√£o deste middleware e usar qualquer estrat√©gia que se ajuste ao seu caso de uso e √†s necessidades do aplicativo. Apenas tenha os seguintes pontos em mente.

- Certifique-se de sempre passar a localidade selecionada pelo usu√°rio para o m√©todo `I18n.getSupportedLocale(userLocale)` para encontrar a melhor localidade poss√≠vel suportada pelo seu aplicativo.
- Se uma correspond√™ncia for encontrada, chame o m√©todo `ctx.i18n.switchLocale(locale)` para alternar o local para o restante da solicita√ß√£o.

Al√©m disso, certifique-se de registrar o middleware dentro do arquivo `start/kernel.ts`.

```ts
// start/kernel.ts

Server.middleware.register([
  // ... other middleware(s)
  () => import('App/Middleware/DetectUserLocale')
])
```

**Confira este [projeto de exemplo](https://github.com/adonisjs-community/i18n-language-switcher) que usa o alternador de idioma no aplicativo e sess√µes para gerenciar o idioma preferido do usu√°rio.**

## Armazenamento de tradu√ß√µes
O carregador `fs` (padr√£o) procura as tradu√ß√µes dentro do diret√≥rio `resources/lang`. Voc√™ deve criar um subdiret√≥rio para cada local que seu aplicativo suporta. Por exemplo:

::: info NOTA
O diret√≥rio de idioma deve ser nomeado ap√≥s um c√≥digo de idioma [ISO 639-1](https://www.andiamo.co.uk/resources/iso-language-codes/) v√°lido
:::

```bash
# resources/lang

‚îú‚îÄ‚îÄ en
‚îî‚îÄ‚îÄ fr
```

O carregador ler√° todos os arquivos `.json` e `.yaml`. Al√©m disso, sinta-se √† vontade para criar v√°rios subdiret√≥rios ou arquivos dentro de um diret√≥rio de idioma.

```bash
# resources/lang

‚îú‚îÄ‚îÄ en
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ emails.yaml
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ validator.json
‚îî‚îÄ‚îÄ fr
    ‚îî‚îÄ‚îÄ validator.json
```

```json
// resources/lang/fr/validator.json

{
  "shared": {
    "required": "Ce champ est requis"
  }
}
```

```yaml
# resources/lang/en/emails.yaml

welcome:
  content: >-
    <h2> Welcome to AdonisJS </h2>
    <p> Click <a href="{ url }"> here </a> to verify your account </p>
```

## Formatando tradu√ß√µes
O formatador `icu` permite que voc√™ escreva tradu√ß√µes usando o [formato de mensagens ICU](https://format-message.github.io/icu-message-format-for-translators/index.html). √â um formato padr√£o da ind√∫stria para escrever tradu√ß√µes e √© suportado por muitos servi√ßos de tradu√ß√£o como Crowdin e Lokalise.

Dada a seguinte mensagem dentro do arquivo `en/messages.json`.

```json
// resources/lang/en/messages.json

{
  "title": "A fully featured web framework for Node.js."
}
```

Voc√™ pode renderiz√°-lo da seguinte forma.

```ts
import I18n from '@ioc:Adonis/Addons/I18n'
I18n.locale('en').formatMessage('messages.title')
```

E renderiz√°-lo dentro de modelos usando o m√©todo auxiliar `t`.

```edge
<h1> {{ t('messages.title') }} </h1>
```

### Interpola√ß√£o
A sintaxe de mensagens ICU usa uma √∫nica chave para referenciar valores din√¢micos. Por exemplo:

::: info NOTA
A sintaxe de mensagens ICU [n√£o suporta conjuntos de dados aninhados](https://github.com/formatjs/formatjs/pull/2039#issuecomment-951550150) e, portanto, voc√™ s√≥ pode acessar propriedades de um objeto plano durante a interpola√ß√£o.
:::

```json
{
  "greeting": "Hello { username }"
}
```

```edge
{{ t('messages.greeting', { username: 'Virk' }) }}
```

Voc√™ tamb√©m pode escrever HTML dentro das mensagens. No entanto, certifique-se de usar tr√™s [chaves](../views/templating-syntax.md#curly-braces) dentro dos modelos do Edge para renderizar HTML sem escapar dele.

### Formato num√©rico
Voc√™ pode formatar valores num√©ricos dentro das mensagens de tradu√ß√£o usando a sintaxe `{key, type, format}`. No exemplo a seguir:

- O `amount` √© o valor de tempo de execu√ß√£o.
- O `number` √© o tipo de formata√ß√£o.
[esqueleto num√©rico](https://unicode-org.github.io/icu/userguide/format_parse/numbers/skeletons.html#overview)

```json
{
  "bagel_price": "The price of this bagel is {amount, number, ::currency/USD}"
}
```

```edge
{{ t('bagel_price', { amount: 2.49 }) }}
```

```
The price of this bagel is $2.49
```

A seguir est√£o alguns exemplos usando o formato `number` com diferentes estilos de formata√ß√£o e esqueletos num√©ricos.

```
Length of the pole: {price, number, ::measure-unit/length-meter}
```

```
Account balance: {price, number, ::currency/USD compact-long}
```

### Formato de data/hora
Voc√™ pode formatar as inst√¢ncias [Date]() ou as inst√¢ncias [luxon DateTime]() usando a sintaxe `{key, type, format}`. No exemplo a seguir:

- `expectedDate` √© o valor de tempo de execu√ß√£o.
- `date` √© o tipo de formata√ß√£o.
- E o `medium` √© o formato da data.

```json
{
  "shipment_update": "Your package will arrive on {expectedDate, date, medium}"
}
```

```edge
{{ t('shipment_update', { expectedDate: luxonDateTime }) }}
```

```
Your package will arrive on Oct 16, 2021
```

Da mesma forma, voc√™ pode usar o formato de hora para formatar a hora para o local atual.

```json
{
  "appointment": "You have an appointment today at {appointmentAt, time, ::h:m a}"
}
```

```txt
You have an appointment today at 2:48 PM
```

#### Esqueletos de data/hora dispon√≠veis

A ICU fornece uma [ampla gama de padr√µes](https://unicode-org.github.io/icu/userguide/format_parse/datetime/#date-field-symbol-table) para personalizar o formato de data e hora. No entanto, nem todos eles est√£o dispon√≠veis via API Intl do ECMA402. Portanto, oferecemos suporte apenas aos seguintes padr√µes.

| S√≠mbolo | Descri√ß√£o         |
|---------|-------------------|
| `G`     | Designador de era |
| `y`     | ano |
| `M`     | m√™s no ano  |
| `L`     | m√™s aut√¥nomo no ano |
| `d`     | dia no m√™s  |
| `E`     | dia da semana |
| `e`     | dia local da semana e..eee n√£o √© suportado  |
| `c`     | dia local aut√¥nomo da semana c..ccc n√£o √© suportado |
| `a`     | Marcador AM/PM  |
| `h`     | Hora [1-12] |
| `H`     | Hora [0-23] |
| `K`     | Hora [0-11] |
| `k`     | Hora [1-24] |
| `m`     | Minuto  |
| `s`     | Segundo |
| `z`     | Fuso hor√°rio  |

### Regras plurais
A sintaxe da mensagem ICU tem suporte de primeira classe para definir as regras plurais dentro de suas mensagens. Por exemplo:

::: info NOTA
No exemplo a seguir, usamos YAML em vez de JSON, pois √© mais f√°cil escrever texto multilinha em YAML.
:::

```yaml
cart_summary:
  "You have {itemsCount, plural,
    =0 {no items}
    one {1 item}
    other {# items}
  } in your cart"
```

```edge
{{ t('messages.cart_summary', { itemsCount: 1 }) }}
```

```
You have 1 item in your cart.
```

O `#` √© um token especial a ser usado como um espa√ßo reservado para o valor num√©rico. Ele ser√° formatado como `{key, number}`.

```edge
{{ t('messages.cart_summary', { itemsCount: 1000 }) }}

<!-- Output -->
<!-- You have 1,000 items in your cart -->
```

#### Categorias plurais dispon√≠veis

A regra plural usa a sintaxe `{key, plural, matches}`. O `matches` √© um valor literal e corresponde a uma das seguintes categorias plurais.

| Categoria | Descri√ß√£o   |
|-----------|-------------|
| `zero`    | Esta categoria √© usada para idiomas com gram√°tica especializada especificamente para n√∫mero zero de itens. (Exemplos s√£o √°rabe e let√£o) |
| `one`     | Esta categoria √© usada para idiomas com gram√°tica explicitamente especializada para um item. Muitos idiomas, mas n√£o todos, usam esta categoria plural. (Muitos idiomas asi√°ticos populares, como chin√™s e japon√™s, n√£o usam esta categoria.) |
| `two`     | Esta categoria √© usada para idiomas que t√™m gram√°tica explicitamente especializada para dois itens. (Exemplos s√£o √°rabe e gal√™s.) |
| `few`     | Esta categoria √© usada para idiomas com gram√°tica explicitamente especializada para um pequeno n√∫mero de itens. Para alguns idiomas, isso √© usado para 2-4 itens, para alguns 3-10 itens, e outros idiomas t√™m regras ainda mais complexas. |
| `many`    | Esta categoria √© usada para idiomas que t√™m uma gram√°tica especializada para um n√∫mero mais significativo de itens. (Exemplos s√£o √°rabe, polon√™s e russo.) |
| `other`   | Esta categoria √© usada se o valor n√£o corresponder a uma das outras categorias plurais. Observe que isso √© usado para "plural" para idiomas (como ingl√™s) que t√™m uma dicotomia simples "singular" versus "plural". |
| `=value`  | Isso √© usado para corresponder a um valor espec√≠fico, independentemente das categorias plurais do local atual. |

Tabela: O conte√∫do da tabela √© referenciado em [formatjs.io](https://formatjs.io/docs/core-concepts/icu-syntax/#plural-format)

### Selecionar
O formato `select` permite que voc√™ escolha a sa√≠da comparando um valor com uma das muitas op√ß√µes. Escrever texto espec√≠fico de g√™nero √© um excelente exemplo do formato `select`.

```yaml
# Yaml

auto_reply:
  "{gender, select,
    male {He}
    female {She}
    other {They}
  } will respond shortly."
```

```edge
{{ t('messages.auto_reply', { gender: 'female' }) }}
```

```
She will respond shortly.
```

### Selecionar ordinal
O formato `select ordinal` permite que voc√™ escolha a sa√≠da com base nas regras de pluraliza√ß√£o ordinal. O formato √© semelhante ao formato `plural`. No entanto, o valor √© mapeado para uma categoria plural ordinal.

```yaml
anniversary_greeting:
  "It's my {years, selectordinal,
    one {#st}
    two {#nd}
    few {#rd}
    other {#th}
  } anniversary"
```

```edge
{{ t('messages.anniversary_greeting', { years: 2 }) }}
```

```txt
It's my 2nd anniversary
```

#### Categorias ordinais selecionadas dispon√≠veis
O formato ordinal selecionado usa a sintaxe {key, selectordinal, matches}. A correspond√™ncia √© um valor literal e corresponde a uma das seguintes categorias plurais.

| Categoria | Descri√ß√£o   |
|-----------|-------------|
| `zero`    | Esta categoria √© usada para idiomas com gram√°tica especializada especificamente para zero n√∫mero de itens. (Exemplos s√£o √°rabe e let√£o.) |
| `one`     | Esta categoria √© usada para idiomas com gram√°tica explicitamente especializada para um item. Muitos idiomas, mas n√£o todos, usam esta categoria plural. (Muitos idiomas asi√°ticos populares, como chin√™s e japon√™s, n√£o usam esta categoria.) |
| `two`     | Esta categoria √© usada para idiomas com gram√°tica explicitamente especializada para dois itens. (Exemplos s√£o √°rabe e gal√™s.) |
| `few`     | Esta categoria √© usada para idiomas com gram√°tica explicitamente especializada para um pequeno n√∫mero de itens. Para alguns idiomas, isto √© usado para 2-4 itens, para alguns 3-10 itens, e outros idiomas t√™m regras ainda mais complexas. |
| `many`    | Esta categoria √© usada para idiomas com gram√°tica especializada para um n√∫mero maior de itens. (Exemplos s√£o √°rabe, polon√™s e russo.) |
| `other`   | Esta categoria √© usada se o valor n√£o corresponder a uma das outras categorias plurais. Observe que isto √© usado para "plural" para idiomas (como ingl√™s) que t√™m uma dicotomia simples "singular" versus "plural". |
| `=value`  | Isso √© usado para corresponder a um valor espec√≠fico, independentemente das categorias plurais do local atual. |

Tabela: O conte√∫do da tabela √© referenciado de [formatjs.io](https://formatjs.io/docs/core-concepts/icu-syntax/#selectordinal-format)

## Formatadores Intl
Os formatadores Intl s√£o wrappers finos sobre a [API Intl do Node.js](https://nodejs.org/dist/latest-v16.x/docs/api/intl.html). Criar uma nova inst√¢ncia das classes Intl √© lento, ent√£o memorizamos os construtores para acelerar as coisas. [Veja benchmarks](https://github.com/poppinss/intl-formatter#benchmarks)

### `formatNumber`
O `formatNumber` usa a classe [Intl.NumberFormat](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat/NumberFormat) para formatar um valor num√©rico.

- O primeiro argumento √© o valor a ser formatado. Deve ser um n√∫mero, bigint ou uma representa√ß√£o de string de um n√∫mero.
- O segundo argumento s√£o as op√ß√µes. Elas s√£o as mesmas que as op√ß√µes aceitas pela classe `Intl.NumberFormat`.

```ts
import I18n from '@ioc:Adonis/Addons/I18n'

I18n
  .locale('en')
  .formatNumber(123456.789, {
    maximumSignificantDigits: 3
  })
```

### `formatCurrency`
O m√©todo `formatCurrency` usa a classe `Intl.NumberFormat`, mas implicitamente define o `style` para moeda.

```ts
import I18n from '@ioc:Adonis/Addons/I18n'

I18n
  .locale('en')
  .formatCurrency(200, {
    currency: 'USD'
  })
```

### `formatDate`
O m√©todo `formatDate` usa a classe [Intl.DateTimeFormat](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/DateTimeFormat/DateTimeFormat) para formatar uma data.

- O primeiro argumento √© a data a ser formatada. Pode ser uma `string de data ISO`, um `timestamp`, uma inst√¢ncia da classe JavaScript `Date` ou um luxon `DateTime`.
- O segundo argumento s√£o as op√ß√µes. Elas s√£o as mesmas que as op√ß√µes aceitas pela classe `Intl.DateTimeFormat`.

```ts
import I18n from '@ioc:Adonis/Addons/I18n'

I18n
  .locale('en')
  .formatDate(new Date(), {
    dateStyle: 'long'
  })
```

### `formatTime`
O m√©todo `formatTime` usa a classe `Intl.DateTimeFormat`, mas implicitamente define o `timeStyle` como m√©dio.

```ts
import I18n from '@ioc:Adonis/Addons/I18n'

I18n
  .locale('en')
  .formatTime(new Date(), {
    timeStyle: 'long'
  })
```

### `formatRelativeTime`
O m√©todo `formatRelativeTime` usando a classe [Intl.RelativeTimeFormat](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/RelativeTimeFormat/RelativeTimeFormat) para formatar um valor para uma string de representa√ß√£o de tempo relativo.

- O primeiro argumento √© o valor do tempo relativo. Pode ser uma `string de data ISO`, um diff num√©rico absoluto, uma inst√¢ncia da classe JavaScript `Date` ou uma inst√¢ncia de luxon `DateTime`.
[unidades oficialmente suportadas](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/RelativeTimeFormat/format), tamb√©m suportamos uma unidade `auto` adicional.
- O terceiro argumento s√£o as op√ß√µes. Elas s√£o as mesmas que as op√ß√µes aceitas pela classe `Intl.RelativeTimeFormat`.

```ts
import { DateTime } from 'luxon'
import I18n from '@ioc:Adonis/Addons/I18n'

const luxonDate = DateTime.local().plus({ hours: 2 })
I18n
  .locale('en')
  .formatRelativeTime(luxonDate, 'hours')
```

Encontraremos a melhor unidade ao usar a unidade de formata√ß√£o definida como `auto`. Por exemplo:

```ts
const luxonDate = DateTime.local().plus({ hours: 2 })
I18n
  .locale('en')
  .formatRelativeTime(luxonDate, 'auto')

// In 2 hours üëà
```

```ts
const luxonDate = DateTime.local().plus({ hours: 200 })
I18n
  .locale('en')
  .formatRelativeTime(luxonDate, 'auto')

// In 8 days üëà
```

### `formatPlural`
O m√©todo `formatPlural` usa o [Intl.PluralRules](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/PluralRules/PluralRules) e retorna uma categoria plural para um determinado valor num√©rico.

- O primeiro argumento √© o valor. Deve ser um n√∫mero ou uma representa√ß√£o de string de um n√∫mero.
- O segundo argumento s√£o as op√ß√µes. Elas s√£o as mesmas que as op√ß√µes aceitas pela classe `Intl.PluralRules`.

```ts
import I18n from '@ioc:Adonis/Addons/I18n'

I18n.locale('en').formatPlural(0)
// other

I18n.locale('en').formatPlural(1)
// one

I18n.locale('en').formatPlural(2)
// other
```

## Mensagens do validador
A seguir est√£o as etapas para configurar o pacote `i18n` para fornecer as mensagens de valida√ß√£o dos arquivos de tradu√ß√µes.

1. Defina o valor de `provideValidatorMessages = true` dentro do arquivo de configura√ß√£o.
2. Crie um arquivo `validator.json` dentro de cada diret√≥rio de idioma.
3. Defina mensagens para as regras de valida√ß√£o dentro do objeto `shared`.

```json
// resources/lang/en/validator.json

{
  "shared": {
    "required": "The value for the field is required",
    "unique": "Email is already in use",
    "minLength": "The field must have { minLength } items"
  }
}
```

As mensagens da chave `shared` s√£o fornecidas automaticamente ao validador. Voc√™ tamb√©m pode ser espec√≠fico e definir uma mensagem para uma combina√ß√£o `field + rule`. Por exemplo:

```json {4}
{
  "shared": {
    "required": "The value for the field is required",
    "username.required": "Username is required to create an account"
  }
}
```

### Saco de mensagens personalizadas
Se alguma parte do seu aplicativo precisar de mensagens de valida√ß√£o espec√≠ficas, voc√™ pode defini-las dentro do arquivo `validator.json` sob uma chave de n√≠vel superior diferente e, em seguida, referenci√°-las usando o m√©todo `i18n.validatorMessages()`.

```json
// resources/lang/en/validator.json

{
  "shared": {},
  "contact": {
    "email.required": "Enter the email so that we can contact you",
    "message.required": "Describe your project in a few words."
  }
}
```

Agora, voc√™ pode referenciar as mensagens do objeto `contact` no validador da seguinte forma.

```ts {9}
import { schema } from '@ioc:Adonis/Core/Validator'
import { HttpContextContract } from '@ioc:Adonis/Core/HttpContext'

export default class ContactValidator {
  constructor(protected ctx: HttpContextContract) {}

  public schema = schema.create({})

  public messages = this.ctx.i18n.validatorMessages('validator.contact')
}
```

## Mensagens de autentica√ß√£o
Voc√™ tamb√©m pode fornecer tradu√ß√µes para as exce√ß√µes geradas pelo pacote [auth](../auth/introduction.md). As tradu√ß√µes devem ser definidas dentro do arquivo `auth.json` usando o c√≥digo de exce√ß√£o como a chave de tradu√ß√£o.

::: info NOTA
As tradu√ß√µes s√£o usadas para o texto de resposta e n√£o para a propriedade `error.message`. Elas ainda estar√£o em ingl√™s e codificadas.
:::

```json
{
  "E_INVALID_AUTH_SESSION": "Your session has expired",
  "E_INVALID_API_TOKEN": "Invalid or expired API token",
  "E_INVALID_BASIC_CREDENTIALS": "Invalid credentials",
  "E_INVALID_AUTH_UID": "Invalid credentials",
  "E_INVALID_AUTH_PASSWORD": "Invalid credentials"
}
```

## Traduzindo e-mails
Como os e-mails geralmente s√£o enviados em segundo plano (fora do ciclo de vida da solicita√ß√£o HTTP), voc√™ deve passar explicitamente a inst√¢ncia `i18n` para os modelos de e-mail.

O m√©todo auxiliar `t` √© um alias para `i18n.formatMessage`, ele formatar√° mensagens no mesmo idioma para o qual voc√™ criou a inst√¢ncia da classe `i18n` e a passou para o estado do modelo.

```ts {4,8-9}
import Mail from '@ioc:Adonis/Addons/Mail'
import I18n from '@ioc:Adonis/Addons/I18n'

const i18n = I18n.locale(customerLocale)

await Mail.send((message) => {
  message
    .subject(i18n.formatMessage('emails.welcome_subject'))
    .htmlView('emails/welcome', { i18n })
})
```

## Recarregando tradu√ß√µes
As tradu√ß√µes s√£o carregadas e armazenadas em cache na mem√≥ria na inicializa√ß√£o do aplicativo. Portanto, quaisquer altera√ß√µes feitas nos arquivos de tradu√ß√£o n√£o ser√£o refletidas at√© que voc√™ reinicie o processo.

Durante o desenvolvimento, o servidor dev ser√° reiniciado na altera√ß√£o do arquivo. No entanto, na produ√ß√£o, voc√™ ter√° que reiniciar o servidor manualmente (como uma nova implanta√ß√£o).

Se por algum motivo voc√™ quiser recarregar as tradu√ß√µes dentro do processo em execu√ß√£o, poder√° usar o m√©todo `I18n.reloadTranslations()` para fazer isso.

```ts
import I18n from '@ioc:Adonis/Addons/I18n'

await I18n.reloadTranslations()
```

## Relatando tradu√ß√µes ausentes
Para ajudar voc√™ a adicionar progressivamente tradu√ß√µes para novos idiomas, relatamos as tradu√ß√µes ausentes emitindo o evento `i18n:missing:translation`.

Crie um novo arquivo de pr√©-carregamento `start/i18n.ts` executando o seguinte comando Ace. Selecione todos os ambientes.

```sh
node ace make:prldfile i18n
```

Abra o arquivo rec√©m-criado e cole o seguinte conte√∫do dentro dele. Atualmente, estamos usando o m√©todo `I18n.prettyPrint` para registrar a mensagem no console. No entanto, voc√™ tamb√©m pode usar o logger para registrar a mensagem.

```ts
// start/i18n.ts

import Event from '@ioc:Adonis/Core/Event'
import I18n from '@ioc:Adonis/Addons/I18n'

Event.on('i18n:missing:translation', I18n.prettyPrint)
```

## Adicionar formatador de mensagem personalizado
O formatador de mensagem define a sintaxe e os recursos das tradu√ß√µes armazenadas. O pacote √© fornecido com um formatador `icu` que usa a sintaxe de mensagens ICU para escrever tradu√ß√µes.

No entanto, voc√™ tamb√©m pode registrar um formatador de mensagem personalizado usando o m√©todo `I18n.extend`. A implementa√ß√£o do formatador deve aderir √† interface [TranslationsFormatterContract](https://github.com/adonisjs/i18n/blob/develop/adonis-typings/i18n.ts#L87).

```ts
interface TranslationsFormatterContract {
  readonly name: string
  format(message: string, locale: string, data?: Record<string, any>): string
}
```

#### `name`
Um nome exclusivo para o formatador. Ser√° um valor de string est√°tico.

#### `format`
O m√©todo format recebe os seguintes argumentos e deve retornar uma string formatada.

- O primeiro argumento √© o texto da mensagem.
- O segundo argumento √© o `locale` para o qual a formata√ß√£o deve acontecer.
- Finalmente, o objeto de dados para valores din√¢micos.

### Implementa√ß√£o fict√≠cia

A seguir est√° uma implementa√ß√£o muito direta que usa o mecanismo de modelo Edge para formatar tradu√ß√µes.

#### Etapa 1. Crie a classe formatadora.
Crie um novo arquivo `MustacheFormatter.ts` dentro do diret√≥rio `providers` e cole o seguinte conte√∫do dentro dele.

```ts
import type { ViewContract } from '@ioc:Adonis/Core/View'
import type { TranslationsFormatterContract } from '@ioc:Adonis/Addons/I18n'

export class MustacheFormatter implements TranslationsFormatterContract {
  public readonly name = 'mustache'
  constructor(private view: ViewContract) {}

  public format(message: string, _: string, data?: Record<string, any>) {
    return this.view.renderRawSync(message, data)
  }
}
```

#### Etapa 2. Estenda o I18n e registre o formatador
Abra o arquivo `providers/AppProvider.ts` e registre o formatador dentro do m√©todo `boot`.

```ts {4,13-18}
// providers/AppProvider.ts

import { ApplicationContract } from '@ioc:Adonis/Core/Application'
import { MustacheFormatter } from './MustacheFormatter'

export default class AppProvider {
  constructor(protected app: ApplicationContract) {}

  public register() {
    // Registre suas pr√≥prias liga√ß√µes
  }

  public async boot() {
    const I18n = this.app.container.resolveBinding('Adonis/Addons/I18n')
    const View = this.app.container.resolveBinding('Adonis/Core/View')

    I18n.extend('mustache', 'formatter', () => new MustacheFormatter(View))
  }

  public async ready() {
    // O aplicativo est√° pronto
  }

  public async shutdown() {
    // Limpeza, pois o aplicativo est√° fechando
  }
}
```

#### Etapa 3. Use o formatador `mustache`
Atualize o arquivo de configura√ß√£o e defina o `translationsFormat` para mustache.

```ts
{
  translationsFormat: 'mustache'
}
```

## Adicione um carregador de mensagens personalizado
O carregador de mensagens √© respons√°vel por carregar as mensagens de uma fonte permanente. O pacote √© fornecido com um formatador `fs` que l√™ os arquivos `.json` e `.yaml` do sistema de arquivos.

No entanto, voc√™ tamb√©m pode registrar carregadores personalizados usando o m√©todo `I18n.extend`. A implementa√ß√£o do carregador deve aderir √† interface [LoaderContract](https://github.com/adonisjs/i18n/blob/develop/adonis-typings/i18n.ts#L79).

```ts
type Translations = {
  [lang: string]: Record<string, string>
}

interface LoaderContract {
  load(): Promise<Translations>
}
```

Os carregadores s√≥ precisam implementar um √∫nico m√©todo chamado `load` que retorna todas as tradu√ß√µes como um objeto.

As chaves de n√≠vel superior do objeto s√£o os c√≥digos de idioma, e o valor √© outro objeto de mensagens.

```ts
{
  en: {},
  fr: {},
  it: {}
}
```

Al√©m disso, certifique-se de converter mensagens aninhadas dentro de um objeto de idioma para um objeto simples. Por exemplo:

```ts
{
  en: {
    'messages.title': '',
    'messages.subtitle': ''
  }
}
```

### Implementa√ß√£o fict√≠cia
A seguir est√° uma implementa√ß√£o muito direta que l√™ as mensagens do banco de dados usando Lucid.

#### Etapa 1. Crie a classe do carregador.
Crie um novo arquivo `DbLoader.ts` dentro do diret√≥rio `providers` e cole o seguinte conte√∫do dentro dele.

```ts
import type { DatabaseContract } from '@ioc:Adonis/Lucid/Database'
import type {
  Translations,
  LoaderContract
} from '@ioc:Adonis/Addons/I18n'

export type DbLoaderConfig = {
  enabled: boolean
  table: string
}

export class DbLoader implements LoaderContract {
  constructor(private db: DatabaseContract, private config: DbLoaderConfig) {}

  public async load() {
    const rows = await this.db.from(this.config.table)

    return rows.reduce<Translations>((result, row) => {
      result[row.locale] = result[row.locale] || {}
      result[row.locale][row.key] = row.message
      return result
    }, {})
  }
}
```

#### Etapa 2. Estenda o I18n e registre o carregador
Abra o arquivo `providers/AppProvider.ts` e registre o carregador dentro do m√©todo `boot`.

```ts {4,13-20}
// providers/AppProvider.ts

import { ApplicationContract } from '@ioc:Adonis/Core/Application'
import { DbLoader } from './DbLoader'

export default class AppProvider {
  constructor(protected app: ApplicationContract) {}

  public register() {
    // Registre suas pr√≥prias liga√ß√µes
  }

  public async boot() {
    const I18n = this.app.container.resolveBinding('Adonis/Addons/I18n')
    const Db = this.app.container.resolveBinding('Adonis/Lucid/Database')

    I18n.extend('db', 'loader', (_, config) => {
      return new DbLoader(Db, config)
    })
  }

  public async ready() {
    // O aplicativo est√° pronto
  }

  public async shutdown() {
    // Limpeza, pois o aplicativo est√° fechando
  }
}
```

#### Etapa 3. Use o carregador `db`
Atualize o arquivo de configura√ß√£o e adicione a chave do carregador `db` ao objeto `loaders`.

```ts
{
  loaders: {
    fs: {},
    db: {
      enabled: true,
      table: 'translations'
    }
  }
}
```

#### Etapa 4. Crie a tabela de tradu√ß√µes
Use a migra√ß√£o a seguir para criar a tabela de tradu√ß√µes.

::: info NOTA
Ao executar a migra√ß√£o, voc√™ ter√° que desabilitar o carregador `db` dentro do arquivo de configura√ß√£o. Caso contr√°rio, o carregador tentar√° ler as mensagens de uma tabela n√£o existente.
:::

```ts
import BaseSchema from '@ioc:Adonis/Lucid/Schema'

export default class Translations extends BaseSchema {
  protected tableName = 'translations'

  public async up() {
    this.schema.createTable(this.tableName, (table) => {
      table.increments('id')
      table.string('locale', 8).notNullable()
      table.string('key').notNullable()
      table.text('message', 'longtext').notNullable()

      table.timestamp('created_at', { useTz: true })
      table.timestamp('updated_at', { useTz: true })

      table.unique(['locale', 'key'])
    })
  }

  public async down() {
    this.schema.dropTable(this.tableName)
  }
}
```

## Leitura adicional
Certifique-se de ler o [guia de refer√™ncia da API](../../reference/i18n/i18n-manager.md) para visualizar todas as propriedades e m√©todos dispon√≠veis.
