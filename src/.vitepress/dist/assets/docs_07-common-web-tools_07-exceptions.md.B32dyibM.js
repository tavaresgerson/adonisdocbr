import{_ as e,c as a,o,a4 as t}from"./chunks/framework.nQaBHiNx.js";const E=JSON.parse('{"title":"Tratamento de erros e exceções","description":"","frontmatter":{},"headers":[],"relativePath":"docs/07-common-web-tools/07-exceptions.md","filePath":"docs/07-common-web-tools/07-exceptions.md"}'),s={name:"docs/07-common-web-tools/07-exceptions.md"},r=t(`<h1 id="tratamento-de-erros-e-excecoes" tabindex="-1">Tratamento de erros e exceções <a class="header-anchor" href="#tratamento-de-erros-e-excecoes" aria-label="Permalink to &quot;Tratamento de erros e exceções&quot;">​</a></h1><p>O AdonisJs dá um passo a mais em direção ao tratamento e lançamento de exceções, garantindo que as exceções lançadas pelo núcleo do framework sejam mais descritivas e úteis para depuração. Além disso, ele oferece ferramentas e práticas adicionais para estruturar mensagens de exceção bem projetadas.</p><h2 id="por-que-as-excecoes-sao-importantes" tabindex="-1">Por que as exceções são importantes? <a class="header-anchor" href="#por-que-as-excecoes-sao-importantes" aria-label="Permalink to &quot;Por que as exceções são importantes?&quot;">​</a></h2><p>As exceções não recebem o cuidado que merecem. A maioria dos programadores pensa em exceções como uma forma de encerrar o processo quando algo ruim acontece. Pior ainda, as mensagens de exceção não compartilham muito contexto sobre como corrigir o problema e deixam para o usuário final descobrir a causa.</p><p>Com o AdonisJs, marcamos todas as exceções com um <em>código de erro</em> exclusivo e você pode consultar a documentação do código de erro fornecido para entender a causa da exceção.</p><p>Além disso, também oferecemos um bom pacote npm chamado <a href="https://npmjs.org/package/node-exceptions" target="_blank" rel="noreferrer">node-exceptions</a> para configurar classes de exceção específicas do aplicativo para lançar exceções pessoais e significativas.</p><h2 id="codigos-de-erro" tabindex="-1">Códigos de erro <a class="header-anchor" href="#codigos-de-erro" aria-label="Permalink to &quot;Códigos de erro&quot;">​</a></h2><p>Abaixo está a lista de códigos de erro lançados pelo núcleo do AdonisJs. Você pode referenciá-los para entender o contexto da exceção.</p><p>Todas as exceções são divididas em várias categorias, como <em>Geral</em>, <em>Banco de dados</em>, <em>Redis</em>, etc.</p><h3 id="geral" tabindex="-1">Geral <a class="header-anchor" href="#geral" aria-label="Permalink to &quot;Geral&quot;">​</a></h3><p>Exceções gerais são levantadas de qualquer parte do framework.</p><table><thead><tr><th>Código de erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_MISSING_APPKEY</td><td>A chave do aplicativo é usada para criptografar cookies ou qualquer outro valor sensível. Essa exceção é gerada quando <code>appKey</code> não é definido dentro do arquivo <code>config/app.js</code> que se refere a um valor dentro do arquivo <code>.env</code>. Você pode usar um comando ace para gerar a chave do aplicativo para você. <code>./ace key:generate</code>.</td></tr><tr><td>E_MALFORMED_JSON</td><td>Essa exceção é gerada quando uma função espera que o parâmetro seja uma string <code>JSON</code> válida, mas não consegue chamar o método <code>JSON.parse</code> nela.</td></tr><tr><td>E_MISSING_PARAMETER</td><td>A exceção mais frequentemente gerada é quando um parâmetro esperado por um método não está sendo passado ou é <code>indefinido</code>.</td></tr><tr><td>E_INVALID_PARAMETER</td><td>Esta exceção é gerada quando o valor do parâmetro não é do tipo correto. Por exemplo, um método espera que <code>age</code> seja <em>Number</em>, mas em vez disso, uma <em>String</em> é passada.</td></tr><tr><td>E_MISSING_CONFIG</td><td>Quando a configuração para uma determinada chave está faltando. A exceção é levantada por <em>Provedores de serviço</em> quando eles estão tentando acessar a configuração e não conseguem encontrá-la dentro do diretório <code>config</code>.</td></tr><tr><td>E_UNDEFINED_METHOD</td><td>Essa exceção é gerada quando um cliente tenta acessar um método inexistente.</td></tr></tbody></table><h3 id="provedor-de-criptografia" tabindex="-1">Provedor de criptografia <a class="header-anchor" href="#provedor-de-criptografia" aria-label="Permalink to &quot;Provedor de criptografia&quot;">​</a></h3><p>Abaixo está a lista de exceções levantadas apenas pelo <a href="/docs/09-security/04-encryption-and-hashing.html">Provedor de criptografia</a>.</p><table><thead><tr><th>Código de erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_INVALID_ENCRPYTION_CIPHER</td><td>Esta exceção é gerada quando uma cifra não suportada é usada para criptografar/descriptografar um valor.</td></tr><tr><td>E_INVALID_ENCRYPTION_PAYLOAD</td><td>Esta exceção é gerada quando a carga útil passada para o método <code>encrypt</code> não é legível.</td></tr><tr><td>E_INVALID_ENCRYPTION_MAC</td><td>Esta exceção é gerada quando um mac de criptografia não suportado é definido para criptografar/descriptografar um valor.</td></tr></tbody></table><h3 id="construtor-de-formularios-e-provedor-de-rotas" tabindex="-1">Construtor de formulários e provedor de rotas <a class="header-anchor" href="#construtor-de-formularios-e-provedor-de-rotas" aria-label="Permalink to &quot;Construtor de formulários e provedor de rotas&quot;">​</a></h3><p>Abaixo está a lista de todas as exceções levantadas apenas pelo <a href="/docs/04-views/03-form-builder.html">Form Builder</a> ou pelo <a href="/docs/03-getting-started/05-routing.html">Route provider</a>.</p><table><thead><tr><th>Código de erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_MISSING_ROUTE</td><td>Essa exceção é levantada quando você está tentando referenciar uma <em>Route</em> não existente dentro de suas views. O lugar mais comum é dentro do builder.</td></tr><tr><td>E_MISSING_ROUTE_ACTION</td><td>Uma exceção é gerada pelo <a href="/docs/04-views/03-form-builder.html">Construtor de formulários</a> quando uma ação de controlador/rota não registrada é passada para o método <code>open</code>.</td></tr></tbody></table><h3 id="provedor-de-eventos" tabindex="-1">Provedor de eventos <a class="header-anchor" href="#provedor-de-eventos" aria-label="Permalink to &quot;Provedor de eventos&quot;">​</a></h3><table><thead><tr><th>Código de erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_MISSING_NAMED_EVENT</td><td>O provedor link:events[Event] gerará essa exceção quando você tentar remover um ouvinte nomeado não registrado.</td></tr></tbody></table><h3 id="provedor-de-sessao" tabindex="-1">Provedor de Sessão <a class="header-anchor" href="#provedor-de-sessao" aria-label="Permalink to &quot;Provedor de Sessão&quot;">​</a></h3><table><thead><tr><th>Código de erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_INVALID_SESSION_DRIVER</td><td>Uma exceção é gerada quando o driver de sessão definido dentro do arquivo <code>config/session.js</code> não existe.</td></tr></tbody></table><h3 id="provedor-de-middleware" tabindex="-1">Provedor de Middleware <a class="header-anchor" href="#provedor-de-middleware" aria-label="Permalink to &quot;Provedor de Middleware&quot;">​</a></h3><table><thead><tr><th>Código de erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_MISSING_NAMED_MIDDLEWARE</td><td>Essa exceção é gerada quando um middleware nomeado não registrado é referenciado nas rotas.</td></tr></tbody></table><h3 id="provedor-de-banco-de-dados" tabindex="-1">Provedor de banco de dados <a class="header-anchor" href="#provedor-de-banco-de-dados" aria-label="Permalink to &quot;Provedor de banco de dados&quot;">​</a></h3><table><thead><tr><th>Código de erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_MISSING_MODEL_FACTORY</td><td>Essa exceção é gerada quando você tenta acessar uma fábrica de modelos não registrada. Certifique-se de definir fábricas/blueprints de modelos dentro do arquivo <code>database/factory.js</code>.</td></tr><tr><td>E_MISSING_DATABASE_FACTORY</td><td>Essa exceção é gerada quando você tenta acessar uma fábrica de banco de dados não registrada. Certifique-se de definir fábricas/blueprints de modelo dentro do arquivo <code>database/factory.js</code>.</td></tr><tr><td>E_MISSING_DATABASE_ROW</td><td>Essa exceção é gerada por métodos do modelo Lucid como <em>findOrFail</em> e <em>findByOrFail</em> quando não é possível encontrar um registro com o valor fornecido.</td></tr><tr><td>E_INVALID_MODEL_STATE</td><td>Essa exceção é gerada quando você tenta salvar um modelo vazio ou atualizar uma instância de modelo de exclusão.</td></tr><tr><td>E_UNSAVED_MODEL_INSTANCE</td><td>Essa exceção é gerada quando você tenta salvar um relacionamento em um modelo que não foi salvo.</td></tr><tr><td>E_INVALID_RELATION_INSTANCE</td><td>This exception is raised when you pass an invalid model instance to the relationship <code>save</code> method.</td></tr><tr><td>E_INVALID_RELATION_METHOD</td><td>Essa exceção é gerada quando você chama um método <em>undefined</em> em uma instância de relacionamento. Por exemplo, o relacionamento <em>HasOne</em> não tem um método <code>paginate</code>.</td></tr><tr><td>E_MISSING_DATABASE_RELATION</td><td>Essa exceção é gerada quando você tenta acessar um relacionamento que nunca foi definido.</td></tr><tr><td>E_LOCK_ON_MIGRATIONS</td><td>Essa exceção é gerada quando você tenta executar migrações paralelamente mais de uma vez.</td></tr><tr><td>E_INVALID_SCHEMA_FILE</td><td>Esta exceção é gerada quando os arquivos <em>schema</em> dentro da pasta <code>database/migrations</code> não estão exportando uma classe <em>ES2015</em>.</td></tr><tr><td>E_UNSAFE_ENVIRONMENT</td><td>Essa exceção é gerada quando você está tentando executar operações inseguras no ambiente de produção. Por exemplo: Executando migrações em produção.</td></tr><tr><td>E_INVALID_MODEL_TRAIT</td><td>Essa exceção é gerada quando uma característica do modelo não possui um método <code>register</code>.</td></tr></tbody></table><h3 id="provedor-de-e-mail" tabindex="-1">Provedor de e-mail <a class="header-anchor" href="#provedor-de-e-mail" aria-label="Permalink to &quot;Provedor de e-mail&quot;">​</a></h3><table><thead><tr><th>Código de erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_INVALID_MAIL_DRIVER</td><td>Esta exceção é gerada quando você tenta acessar um driver de e-mail não registrado.</td></tr><tr><td>E_INVALID_MAIL_VIEW</td><td>Esta exceção é gerada quando você tenta chamar o método <code>Mail.send</code> sem uma view válida.</td></tr></tbody></table><h3 id="conteiner-ioc" tabindex="-1">Contêiner IoC <a class="header-anchor" href="#conteiner-ioc" aria-label="Permalink to &quot;Contêiner IoC&quot;">​</a></h3><table><thead><tr><th>Código de erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_INVALID_IOC_MANAGER</td><td>Essa exceção é gerada quando você tenta registrar um gerente no contêiner IoC sem o método <code>extend</code>.</td></tr><tr><td>E_INVALID_MAKE_STRING</td><td>Esta exceção é gerada quando uma string passada para <code>Ioc.makeFunc</code> está incorreta. Strings precisam ter nomes de classe e função separados por <em>ponto(.)</em>. Por exemplo: <code>Ioc.makeFunc(&#39;UserController.store&#39;)</code></td></tr></tbody></table><h3 id="provedor-antl" tabindex="-1">Provedor Antl <a class="header-anchor" href="#provedor-antl" aria-label="Permalink to &quot;Provedor Antl&quot;">​</a></h3><table><thead><tr><th>Código de erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_INVALID_ANTL_DRIVER</td><td>Uma exceção é gerada quando o driver antl definido dentro do arquivo <code>config/antl.js</code> não existe.</td></tr></tbody></table><h3 id="provedor-ally-autenticacao-social" tabindex="-1">Provedor Ally (Autenticação Social) <a class="header-anchor" href="#provedor-ally-autenticacao-social" aria-label="Permalink to &quot;Provedor Ally (Autenticação Social)&quot;">​</a></h3><table><thead><tr><th>Código de erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_OAUTH_TOKEN_EXCHANGE</td><td>Esta exceção é gerada quando não é possível trocar o token de acesso usando o código oauth. Isso geralmente acontece dentro do retorno de chamada ao usar o método <a href="/docs/07-common-web-tools/14-social-auth.html">getUser</a>.</td></tr><tr><td>E_INVALID_ALLY_DRIVER</td><td>Esta exceção é gerada quando o driver aliado definido dentro do arquivo <code>config/services.js</code> não existe.</td></tr><tr><td>E_MISSING_OAUTH_CONFIG</td><td>Essa exceção é gerada quando a configuração aliada não existe para um determinado driver.</td></tr></tbody></table><h2 id="lancando-excecoes" tabindex="-1">Lançando exceções <a class="header-anchor" href="#lancando-excecoes" aria-label="Permalink to &quot;Lançando exceções&quot;">​</a></h2><p>É recomendado lançar uma exceção contextual, pois isso torna mais fácil para o usuário final agir sobre elas. O AdonisJs usa <a href="https://npmjs.org/package/node-exceptions" target="_blank" rel="noreferrer">node-exception</a> um módulo npm para estruturar exceções. Você pode aprender mais sobre ele por meio de sua documentação.</p><h2 id="capturando-excecao" tabindex="-1">Capturando exceção <a class="header-anchor" href="#capturando-excecao" aria-label="Permalink to &quot;Capturando exceção&quot;">​</a></h2><p>Exceções podem ser capturadas envolvendo seu código dentro de um bloco <code>try/catch</code>, ou você pode lidar com elas globalmente ouvindo o evento <code>error</code>.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/Listeners/Http.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleError</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ModelNotFoundException&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    yield</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sendView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;404&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;PasswordMisMatch&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Invalid credentials&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error.status).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error.message) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Com a ajuda de exceções personalizadas, é muito fácil capturá-las com seu <em>nome</em> e retornar uma resposta personalizada para cada tipo de exceção.</p><ol><li>Manipulando a exceção <em>ModelNotFoundException</em> lançada pelo método <code>findOrFail</code> do modelo Lucid e retornando uma visualização <em>404</em>.</li><li>Manipulação da exceção <em>PasswordMisMatch</em> gerada pelo <a href="/docs/07-common-web-tools/02-authentication.html#attemptuid-password">provedor de autenticação</a> e retorno de status <em>400</em>.</li><li>Manipulação genérica de exceções para todas as outras exceções.</li></ol>`,41),d=[r];function i(n,c,l,h,p,m){return o(),a("div",null,d)}const k=e(s,[["render",i]]);export{E as __pageData,k as default};
