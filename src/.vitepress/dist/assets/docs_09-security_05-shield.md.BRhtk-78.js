import{_ as s,c as a,o as i,a4 as e}from"./chunks/framework.nQaBHiNx.js";const E=JSON.parse('{"title":"Middleware Shield","description":"","frontmatter":{},"headers":[],"relativePath":"docs/09-security/05-shield.md","filePath":"docs/09-security/05-shield.md"}'),t={name:"docs/09-security/05-shield.md"},n=e(`<h1 id="middleware-shield" tabindex="-1">Middleware Shield <a class="header-anchor" href="#middleware-shield" aria-label="Permalink to &quot;Middleware Shield&quot;">​</a></h1><p>Além de <a href="/docs/09-security/02-cors.html">CORS</a> e <a href="/docs/09-security/03-csrf-protection.html">CSRF</a>, o AdonisJs também previne seus aplicativos da web de outros ataques de malware como <em>XSS</em>, <em>Content Sniffing</em>, <em>Script Injection</em>, etc. Cada novo aplicativo é pré-configurado para fazer uso do middleware <code>shield</code> que mantém seus sites seguros.</p><div class="info custom-block"><p class="custom-block-title">NOTA</p><p>Não existe uma solução mágica para proteger seus sites completamente. O AdonisJs como uma estrutura oferece várias maneiras de prevenir ataques comuns da web.</p></div><h2 id="configuracao-e-configuracao" tabindex="-1">Configuração e configuração <a class="header-anchor" href="#configuracao-e-configuracao" aria-label="Permalink to &quot;Configuração e configuração&quot;">​</a></h2><p>Certifique-se de que o middleware <em>shield</em> seja adicionado à lista de middleware global dentro do arquivo <code>app/Http/kernel.js</code>.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/Http/kernel.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> globalMiddlewares</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;Adonis/Middleware/Shield&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p>O arquivo de configuração para shield está disponível dentro do arquivo <code>config/shield.js</code>. Você é livre para configurá-lo conforme suas necessidades.</p><h2 id="politica-de-seguranca-de-conteudo" tabindex="-1">Política de Segurança de Conteúdo <a class="header-anchor" href="#politica-de-seguranca-de-conteudo" aria-label="Permalink to &quot;Política de Segurança de Conteúdo&quot;">​</a></h2><p>A Política de Segurança de Conteúdo (CSP) ajuda você a definir as fontes confiáveis ​​para carregar e executar <em>scripts</em>, <em>estilos</em>, <em>fontes</em> e vários outros recursos.</p><p>É uma boa prática ser rigoroso ao permitir a execução de scripts de diferentes fontes. Você deve ler este artigo interessante de <a href="http://www.html5rocks.com/en/tutorials/security/content-security-policy" target="_blank" rel="noreferrer">HTML5 rocks</a>.</p><h3 id="configuracao" tabindex="-1">Configuração <a class="header-anchor" href="#configuracao" aria-label="Permalink to &quot;Configuração&quot;">​</a></h3><p>O bloco <code>csp</code> dentro do arquivo de configuração do shield define a regra para a política de segurança de conteúdo.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">csp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  directives</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    defaultSrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;self&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://getcdn.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    scriptSrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;self&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@nonce&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    styleSrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://getbootstrap.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    imgSrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://dropbox.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  reportOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  setAllHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  disableAndroid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><table><thead><tr><th>Key</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>directives</td><td>Object</td><td>As diretivas ajudam você a definir políticas a serem aplicadas em diferentes tipos de recursos. Você pode obter a lista de todas as diretivas em <a href="http://content-security-policy.com" target="_blank" rel="noreferrer">http://content-security-policy.com</a>.</td></tr><tr><td>reportOnly</td><td>Boolean</td><td>Ela não interromperá a execução da sua página, em vez disso, retornará um aviso de que algumas regras foram violadas.</td></tr><tr><td>setAllHeaders</td><td>Boolean</td><td>O Shield define diferentes cabeçalhos HTTP para diferentes navegadores. Para desabilitar esse comportamento, você pode definir esse valor como true e todos os cabeçalhos serão definidos.</td></tr><tr><td>disableAndroid</td><td>Boolean</td><td>O Android tem bugs com CSP, você pode desabilitá-lo para Android caso tenha algum problema.</td></tr></tbody></table><h3 id="suporte-ao-navegador" tabindex="-1">Suporte ao navegador <a class="header-anchor" href="#suporte-ao-navegador" aria-label="Permalink to &quot;Suporte ao navegador&quot;">​</a></h3><p>Quase todos os navegadores modernos oferecem suporte amplo ao CSP, mas aqui está a <a href="http://caniuse.com/#feat=contentsecuritypolicy" target="_blank" rel="noreferrer">lista</a> mais precisa de navegadores suportados.</p><h3 id="politica-csp-via-meta-tags" tabindex="-1">Política CSP via Meta Tags <a class="header-anchor" href="#politica-csp-via-meta-tags" aria-label="Permalink to &quot;Política CSP via Meta Tags&quot;">​</a></h3><p>O middleware <code>shield</code> define automaticamente os cabeçalhos HTTP necessários para o CSP funcionar, mas também fornece um auxiliar de visualização para definir a meta tag.</p><div class="language-twig vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">twig</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{{ cspMeta }}</span></span></code></pre></div><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!-- Output --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">meta</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http-equiv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Content-Security-Policy&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h3 id="csp-nonce" tabindex="-1">CSP Nonce <a class="header-anchor" href="#csp-nonce" aria-label="Permalink to &quot;CSP Nonce&quot;">​</a></h3><p>As tags de script com código javascript inline são automaticamente confiáveis ​​e executadas pelo navegador. Para interromper esse comportamento, você deve permitir apenas os blocos de script inline confiáveis ​​adicionando <code>@nonce</code> ao array <code>scriptSrc</code>.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">csp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  directives</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    scriptSrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;self&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@nonce&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Agora você precisa informar ao navegador que seus blocos de script inline selecionados devem ser executados, e essa seleção é feita com a ajuda de uma visualização global.</p><div class="language-twig vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">twig</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> nonce</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{{ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cspNonce</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> }}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h2 id="protecao-contra-malware" tabindex="-1">Proteção contra malware <a class="header-anchor" href="#protecao-contra-malware" aria-label="Permalink to &quot;Proteção contra malware&quot;">​</a></h2><p>A proteção contra malware ajuda a proteger seu site de ataques <em>XSS</em>, <em>iframe embeds</em> indesejados, <em>content-type sniffing</em> e impede que o IE execute scripts não solicitados no contexto de sua página da web.</p><h3 id="xss" tabindex="-1">XSS <a class="header-anchor" href="#xss" aria-label="Permalink to &quot;XSS&quot;">​</a></h3><p>Use a configuração definida abaixo para habilitar/desabilitar a proteção XSS. Isso é feito definindo <code>X-XSS-Protection=1; mode=block</code></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xss</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  enableOnOldIE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="sem-sniff" tabindex="-1">Sem Sniff <a class="header-anchor" href="#sem-sniff" aria-label="Permalink to &quot;Sem Sniff&quot;">​</a></h3><p>A maioria dos navegadores modernos tentará detectar o <em>Content-Type</em> de uma solicitação farejando seu conteúdo. O que significa que um arquivo terminado em <em>.txt</em> pode ser executado como um arquivo javascript, se contiver código javascript. Para desabilitar esse comportamento, defina <code>nosniff=false</code>.</p><p>A configuração abaixo definirá o valor do cabeçalho <code>X-Content-Type-Options</code> para <em>nosniff</em>.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  nosniff</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="no-open" tabindex="-1">No Open <a class="header-anchor" href="#no-open" aria-label="Permalink to &quot;No Open&quot;">​</a></h3><p>Esta configuração impedirá que o IE execute script desconhecido no contexto do seu site. A configuração abaixo definirá o valor de <code>X-Download-Options</code> para <em>noopen</em>.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  noopen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="xframe" tabindex="-1">XFrame <a class="header-anchor" href="#xframe" aria-label="Permalink to &quot;XFrame&quot;">​</a></h3><p>A opção xframe dentro do arquivo <code>config/shield.js</code> facilita o controle do comportamento de incorporação do seu site dentro de um iframe. Você pode escolher entre <code>DENY</code>, <code>ALLOW</code> ou <code>ALLOW-FROM http://mywebsite.com</code>.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  xframe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DENY&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>`,40),o=[n];function l(p,r,d,h,c,k){return i(),a("div",null,o)}const u=s(t,[["render",l]]);export{E as __pageData,u as default};
