import{_ as e,c as s,a2 as i,o}from"./chunks/framework.BLTIpkzl.js";const h=JSON.parse('{"title":"Heroku","description":"","frontmatter":{},"headers":[],"relativePath":"docs/cookbooks/deployment/heroku.md","filePath":"docs/cookbooks/deployment/heroku.md"}'),n={name:"docs/cookbooks/deployment/heroku.md"};function r(d,a,t,p,l,c){return o(),s("div",null,a[0]||(a[0]=[i(`<h1 id="heroku" tabindex="-1">Heroku <a class="header-anchor" href="#heroku" aria-label="Permalink to &quot;Heroku&quot;">​</a></h1><p>Este guia abrange as etapas de ação para implantar um aplicativo AdonisJS no <a href="https://devcenter.heroku.com/articles/deploying-nodejs" target="_blank" rel="noreferrer">Heroku</a>.</p><p>Implantar um aplicativo AdonisJS não é diferente de implantar um aplicativo Node.js padrão. Você só precisa manter algumas coisas em mente:</p><ul><li>Você constrói sua fonte TypeScript para JavaScript, antes de implantar o aplicativo.</li><li>Você terá que iniciar o servidor a partir da pasta <code>build</code> e não da raiz do projeto. O mesmo vale para executar migrações em quaisquer outros aplicativos Node.js.</li></ul><p>Você pode construir seu projeto para produção executando o seguinte comando ace. Saiba mais sobre o <a href="/docs/guides/fundamentals/typescript-build-process.html">processo de construção do TypeScript</a></p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --production</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># OU use o script npm</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="adicionando-o-procfile" tabindex="-1">Adicionando o Procfile <a class="header-anchor" href="#adicionando-o-procfile" aria-label="Permalink to &quot;Adicionando o Procfile&quot;">​</a></h2><p>Antes de enviar seu código para o Heroku para implantação, certifique-se de criar um <a href="https://devcenter.heroku.com/articles/procfile#deploying-to-heroku" target="_blank" rel="noreferrer">Procfile</a> na raiz do seu aplicativo.</p><p>O arquivo instrui o Heroku a sempre executar as migrações durante o lançamento e iniciar o servidor a partir da pasta <code>build</code>.</p><div class="language-text vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>web: node build/server.js</span></span>
<span class="line"><span>release: node build/ace migration:run --force</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="definindo-variaveis-​​de-ambiente" tabindex="-1">Definindo variáveis ​​de ambiente <a class="header-anchor" href="#definindo-variaveis-​​de-ambiente" aria-label="Permalink to &quot;Definindo variáveis ​​de ambiente&quot;">​</a></h2><p>Você também deve definir as variáveis ​​de ambiente no painel do Heroku. Você pode consultar o <code>.env</code> de desenvolvimento para as variáveis ​​que você precisa definir com o Heroku.</p><ul><li>Não defina a variável de ambiente <code>PORT</code>. O Heroku a definirá para você automaticamente.</li><li>Certifique-se de gerar a chave do aplicativo executando o comando <code>node ace generate:key</code> e defina-a como variável de ambiente <code>APP_KEY</code>.</li><li>Salve a <code>APP_KEY</code> com segurança. Se você perder essa chave, todos os dados de criptografia, cookies e sessões se tornarão inválidos.</li></ul><p><img src="https://res.cloudinary.com/adonis-js/image/upload/f_auto,q_auto/v1619085409/v5/heroku-env-vars.jpg" alt="imagem"></p><h2 id="hora-de-implantar" tabindex="-1">Hora de implantar <a class="header-anchor" href="#hora-de-implantar" aria-label="Permalink to &quot;Hora de implantar&quot;">​</a></h2><p>Agora você pode enviar seu código para o Heroku executando o comando <code>git push heroku master</code>. O Heroku executará as seguintes etapas para você.</p><ul><li>Ele detectará seu aplicativo como um aplicativo Node.js e usará o buildpack <code>heroku/nodejs</code> para construí-lo e implantá-lo.</li><li>Ele detectará o script <code>build</code> dentro do arquivo <code>package.json</code> e construirá seu código TypeScript para JavaScript. <strong>Você deve sempre executar o código JavaScript em produção</strong>. <a href="https://docs.npmjs.com/cli/v7/commands/npm-prune" target="_blank" rel="noreferrer">prune</a> as dependências de desenvolvimento.</li><li>Executa o script <code>release</code> definido dentro do <code>Procfile</code>.</li><li>Executa o script <code>web</code> definido dentro do <code>Procfile</code>.</li></ul><h2 id="usando-banco-de-dados" tabindex="-1">Usando banco de dados <a class="header-anchor" href="#usando-banco-de-dados" aria-label="Permalink to &quot;Usando banco de dados&quot;">​</a></h2><p>Você pode usar os complementos do Heroku para adicionar um banco de dados ao seu aplicativo. Apenas certifique-se de definir as variáveis ​​de ambiente necessárias para o AdonisJS se conectar ao seu banco de dados.</p><p>Novamente, você pode consultar o <code>.env</code> de desenvolvimento para visualizar o nome das variáveis ​​de ambiente que você está usando para conexão com o banco de dados.</p><div class="info custom-block"><p class="custom-block-title">NOTA</p><p>Se você estiver usando PostgreSQL e recebendo o erro <code>pg_hba.conf</code>. Em seguida, certifique-se de habilitar os certificados SSL para seu aplicativo. Se você não puder habilitar o SSL, deverá atualizar a conexão com o banco de dados para permitir conexões não SSL.</p><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// config/database.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;pg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  connection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ....</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ssl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      rejectUnauthorized</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div><h2 id="gerenciando-arquivos-enviados-pelo-usuario" tabindex="-1">Gerenciando arquivos enviados pelo usuário <a class="header-anchor" href="#gerenciando-arquivos-enviados-pelo-usuario" aria-label="Permalink to &quot;Gerenciando arquivos enviados pelo usuário&quot;">​</a></h2><p>O Heroku não tem <a href="https://help.heroku.com/K1PPS2WM/why-are-my-file-uploads-missing-deleted" target="_blank" rel="noreferrer">armazenamento persistente</a>, e você não pode salvar os arquivos enviados pelo usuário no sistema de arquivos do servidor. Isso deixa você com apenas uma opção de salvar os arquivos enviados em um serviço externo como o S3.</p><p>Atualmente, estamos trabalhando em um módulo que permite que você use o sistema de arquivos local durante o desenvolvimento e depois mude para um sistema de arquivos externo como o S3 para produção. Faça tudo isso sem alterar uma única linha de código.</p>`,24)]))}const m=e(n,[["render",r]]);export{h as __pageData,m as default};
