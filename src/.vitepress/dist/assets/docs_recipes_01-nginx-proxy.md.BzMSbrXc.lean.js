import{_ as a,c as i,a2 as e,o as n}from"./chunks/framework.YPpNXepj.js";const c=JSON.parse('{"title":"Proxy Nginx","description":"","frontmatter":{},"headers":[],"relativePath":"docs/recipes/01-nginx-proxy.md","filePath":"docs/recipes/01-nginx-proxy.md"}'),p={name:"docs/recipes/01-nginx-proxy.md"};function t(l,s,o,r,h,d){return n(),i("div",null,s[0]||(s[0]=[e(`<h1 id="proxy-nginx" tabindex="-1">Proxy Nginx <a class="header-anchor" href="#proxy-nginx" aria-label="Permalink to &quot;Proxy Nginx&quot;">​</a></h1><p>Esta receita compartilha as etapas mínimas necessárias para servir o aplicativo AdonisJs usando o proxy <code>nginx</code>.</p><h2 id="primeiros-passos" tabindex="-1">Primeiros passos <a class="header-anchor" href="#primeiros-passos" aria-label="Permalink to &quot;Primeiros passos&quot;">​</a></h2><p>Antes de começar, certifique-se de que você pode executar seu aplicativo na porta definida. Além disso, é recomendável usar um gerenciador de processos como <code>pm2</code> para iniciar seu servidor Node.js.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pm2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server.js</span></span></code></pre></div><p>Verifique se está funcionando</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pm2 list</span></span></code></pre></div><p>Para verificar os logs do aplicativo, você pode executar o seguinte comando</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pm2 logs</span></span></code></pre></div><h2 id="proxy-nginx-1" tabindex="-1">Proxy Nginx <a class="header-anchor" href="#proxy-nginx-1" aria-label="Permalink to &quot;Proxy Nginx&quot;">​</a></h2><p>Abra o arquivo de configuração do servidor <code>default</code>.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># empty the file</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nginx/sites-available/default</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># open in editor</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nginx/sites-available/default</span></span></code></pre></div><p>Além disso, cole o seguinte código dentro dele.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  server_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myapp.com</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  location</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      proxy_pass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:3333</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      proxy_http_version</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Upgrade</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $http_upgrade;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Connection</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;upgrade&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Host</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $host;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> X-Real-IP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> X-Forwarded-Proto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $scheme;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> X-Forwarded-For</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      proxy_cache_bypass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $http_upgrade;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="pontos-a-serem-observados" tabindex="-1">Pontos a serem observados <a class="header-anchor" href="#pontos-a-serem-observados" aria-label="Permalink to &quot;Pontos a serem observados&quot;">​</a></h3><ol><li>Presume-se que <code>nginx</code> esteja instalado e funcionando conforme o esperado.</li><li>Seu aplicativo está sendo executado na <code>PORTA 3333</code>. Caso contrário, altere o bloco <code>proxy_pass</code> dentro do arquivo nginx e defina a porta apropriada.</li><li>Substitua <code>myapp.com</code> pelo domínio real do seu aplicativo.</li><li>Altere o valor de <code>trustProxy</code> para <em>true</em> dentro do arquivo <a href="https://github.com/adonisjs/adonis-slim-app/blob/develop/config/app.js#L43" target="_blank" rel="noreferrer">config/app.js</a>.</li></ol><p>Agora, visitar <code>myapp.com</code> mostra seu aplicativo Adonisjs, já que <code>nginx</code> está fazendo proxy de todas as solicitações para o aplicativo em execução em uma porta especificada.</p>`,17)]))}const g=a(p,[["render",t]]);export{c as __pageData,g as default};
