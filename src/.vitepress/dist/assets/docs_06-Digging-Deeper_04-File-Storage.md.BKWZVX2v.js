import{_ as i,c as a,a2 as e,o as t}from"./chunks/framework.YPpNXepj.js";const n="/assets/Drive_dlcc3v.B84Imn7P.gif",g=JSON.parse('{"title":"Armazenamento de arquivos","description":"","frontmatter":{},"headers":[],"relativePath":"docs/06-Digging-Deeper/04-File-Storage.md","filePath":"docs/06-Digging-Deeper/04-File-Storage.md"}'),o={name:"docs/06-Digging-Deeper/04-File-Storage.md"};function p(l,s,h,r,d,k){return t(),a("div",null,s[0]||(s[0]=[e(`<h1 id="armazenamento-de-arquivos" tabindex="-1">Armazenamento de arquivos <a class="header-anchor" href="#armazenamento-de-arquivos" aria-label="Permalink to &quot;Armazenamento de arquivos&quot;">​</a></h1><p>O AdonisJs tem um <em>Drive Provider</em> dedicado construído sobre o <a href="https://github.com/Slynova-Org/node-flydrive" target="_blank" rel="noreferrer">Flydrive</a> para interagir com sistemas de arquivos locais e remotos como o <em>Amazon S3</em>.</p><p>Neste guia, aprendemos como configurar e usar o <em>Drive Provider</em>.</p><h2 id="configuracao" tabindex="-1">Configuração <a class="header-anchor" href="#configuracao" aria-label="Permalink to &quot;Configuração&quot;">​</a></h2><p>Como o <em>Drive Provider</em> não é instalado por padrão, precisamos obtê-lo do <code>npm</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">adonis</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @adonisjs/drive</span></span></code></pre></div><p>Em seguida, precisamos registrar o provedor dentro do arquivo <code>start/app.js</code>:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// .start/app.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> providers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;@adonisjs/drive/providers/DriveProvider&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">NOTA</p><p>A configuração do driver é salva dentro do arquivo <code>config/drive.js</code>, que é criado pelo comando <code>adonis install</code> ao instalar o <em>Drive Provider</em>.</p></div><h2 id="drivers-disponiveis" tabindex="-1">Drivers disponíveis <a class="header-anchor" href="#drivers-disponiveis" aria-label="Permalink to &quot;Drivers disponíveis&quot;">​</a></h2><p>Os drivers padrão enviados com o <em>Drive Provider</em> são:</p><ol><li>Amazon S3 (<code>s3</code>), que requer o pacote <a href="https://www.npmjs.com/package/aws-sdk" target="_blank" rel="noreferrer">aws-sdk</a></li><li>DigitalOcean Spaces (<code>spaces</code>), que requer o pacote <a href="https://www.npmjs.com/package/aws-sdk" target="_blank" rel="noreferrer">aws-sdk</a></li><li>Sistema de arquivos local (<code>local</code>)</li></ol><h2 id="exemplo-basico" tabindex="-1">Exemplo básico <a class="header-anchor" href="#exemplo-basico" aria-label="Permalink to &quot;Exemplo básico&quot;">​</a></h2><p>Aqui está um exemplo básico de como interagir com o disco local via <code>adonis repl</code>:</p><p><img src="`+n+'" alt="image"></p><h2 id="drive-api" tabindex="-1">Drive API <a class="header-anchor" href="#drive-api" aria-label="Permalink to &quot;Drive API&quot;">​</a></h2><p>Embora operações comuns como leitura e escrita permaneçam as mesmas em todos os drivers, a API de uma unidade é baseada principalmente no driver que você está usando para interagir com o sistema de arquivos dessa unidade.</p><h4 id="exists-relativepath" tabindex="-1"><code>exists(relativePath)</code> <a class="header-anchor" href="#exists-relativepath" aria-label="Permalink to &quot;`exists(relativePath)`&quot;">​</a></h4><p>Descubra se um arquivo/diretório existe ou não:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> exists</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Drive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">exists</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;unicorn.jpg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h4 id="get-relativepath-encoding-utf-8" tabindex="-1"><code>get(relativePath, encoding = utf-8)</code> <a class="header-anchor" href="#get-relativepath-encoding-utf-8" aria-label="Permalink to &quot;`get(relativePath, encoding = utf-8)`&quot;">​</a></h4><p>Obtenha o conteúdo do arquivo como um buffer ou string:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> unicorn</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Drive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;unicorn.jpg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h4 id="getstream-relativepath" tabindex="-1"><code>getStream(relativePath)</code> <a class="header-anchor" href="#getstream-relativepath" aria-label="Permalink to &quot;`getStream(relativePath)`&quot;">​</a></h4><p>Obtenha o arquivo como um fluxo:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Drive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hello.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h4 id="put-relativepath-content-options" tabindex="-1"><code>put(relativePath, content, options = {})</code> <a class="header-anchor" href="#put-relativepath-content-options" aria-label="Permalink to &quot;`put(relativePath, content, options = {})`&quot;">​</a></h4><p>Crie um novo arquivo com o conteúdo fornecido (crie todos os diretórios ausentes):</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Drive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hello.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Buffer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Hello world!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><h4 id="prepend-relativepath-content-options" tabindex="-1"><code>prepend(relativePath, content, options = {})</code> <a class="header-anchor" href="#prepend-relativepath-content-options" aria-label="Permalink to &quot;`prepend(relativePath, content, options = {})`&quot;">​</a></h4><p>Adicione o conteúdo a um arquivo (crie um novo arquivo se o caminho não exist):</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Drive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">prepend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hello.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Buffer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Prepended!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">NOTA</p><p>O método <code>prepend</code> funciona apenas com o driver local.</p></div><h4 id="append-relativepath-content-options" tabindex="-1"><code>append(relativePath, content, options = {})</code> <a class="header-anchor" href="#append-relativepath-content-options" aria-label="Permalink to &quot;`append(relativePath, content, options = {})`&quot;">​</a></h4><p>Acrescenta conteúdo a um arquivo (cria um novo arquivo se o caminho não existir):</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Drive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hello.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Buffer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Appended!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">NOTA</p><p>O método <code>append</code> funciona apenas com o driver local.</p></div><h4 id="delete-relativepath" tabindex="-1"><code>delete(relativePath)</code> <a class="header-anchor" href="#delete-relativepath" aria-label="Permalink to &quot;`delete(relativePath)`&quot;">​</a></h4><p>Remover arquivo existente:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Drive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hello.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h4 id="move-src-dest-options" tabindex="-1"><code>move(src, dest, options = {})</code> <a class="header-anchor" href="#move-src-dest-options" aria-label="Permalink to &quot;`move(src, dest, options = {})`&quot;">​</a></h4><p>Mover arquivo de um diretório para outro:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Drive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">move</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hello.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hi.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h4 id="copy-src-dest-options" tabindex="-1"><code>copy(src, dest, options = {})</code> <a class="header-anchor" href="#copy-src-dest-options" aria-label="Permalink to &quot;`copy(src, dest, options = {})`&quot;">​</a></h4><p>Copiar arquivo de um diretório para outro:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Drive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hi.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hello.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h2 id="api-s3-spaces" tabindex="-1">API S3/Spaces <a class="header-anchor" href="#api-s3-spaces" aria-label="Permalink to &quot;API S3/Spaces&quot;">​</a></h2><p>Os métodos a seguir funcionam apenas para os drivers <code>s3</code> e <code>spaces</code>.</p><h4 id="getobject-location-params" tabindex="-1"><code>getObject(location, params)</code> <a class="header-anchor" href="#getobject-location-params" aria-label="Permalink to &quot;`getObject(location, params)`&quot;">​</a></h4><p>Obter objeto S3 para um arquivo fornecido (para informações sobre <code>params</code>, consulte <a href="http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/S3.html#getObject-property" target="_blank" rel="noreferrer">S3 params</a>):</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Drive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">disk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;s3&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;unicorn.jpg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h4 id="geturl-location-bucket" tabindex="-1"><code>getUrl(location, [bucket])</code> <a class="header-anchor" href="#geturl-location-bucket" aria-label="Permalink to &quot;`getUrl(location, [bucket])`&quot;">​</a></h4><p>Obter url para um arquivo fornecido (aceita parâmetro alternativo opcional <code>bucket</code>):</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Drive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">disk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;s3&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;unicorn.jpg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h4 id="getsignedurl-location-expiry-900-params" tabindex="-1"><code>getSignedUrl(location, expiry = 900, params)</code> <a class="header-anchor" href="#getsignedurl-location-expiry-900-params" aria-label="Permalink to &quot;`getSignedUrl(location, expiry = 900, params)`&quot;">​</a></h4><p>Obter url assinada para um arquivo fornecido (expiração definida como <code>15mins</code> por padrão):</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Drive.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">disk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;s3&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSignedUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;unicorn.jpg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div>',57)]))}const E=i(o,[["render",p]]);export{g as __pageData,E as default};
