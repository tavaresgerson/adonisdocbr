import{_ as a,c as e,o,a4 as t}from"./chunks/framework.nQaBHiNx.js";const E=JSON.parse('{"title":"Tratamento de erros e exceções","description":"","frontmatter":{},"headers":[],"relativePath":"docs/07-common-web-tools/07-exceptions.md","filePath":"docs/07-common-web-tools/07-exceptions.md"}'),s={name:"docs/07-common-web-tools/07-exceptions.md"},d=t(`<h1 id="tratamento-de-erros-e-excecoes" tabindex="-1">Tratamento de erros e exceções <a class="header-anchor" href="#tratamento-de-erros-e-excecoes" aria-label="Permalink to &quot;Tratamento de erros e exceções&quot;">​</a></h1><p>AdonisJS toma um passo adicional para lidar e lançar exceções, garantindo que as exceções lançadas pelo núcleo do framework sejam mais descritivas e úteis para depuração. Também oferece ferramentas e práticas adicionais para estruturar mensagens de exceção bem projetadas.</p><h2 id="por-que-excecoes-sao-importantes" tabindex="-1">Por que exceções são importantes? <a class="header-anchor" href="#por-que-excecoes-sao-importantes" aria-label="Permalink to &quot;Por que exceções são importantes?&quot;">​</a></h2><p>Exceções não recebem a atenção que merecem. A maioria dos programadores pensa em exceções como uma forma de encerrar o processo como algo ruim aconteceu. Mesmo pior, as mensagens de exceção não compartilham muito contexto sobre como corrigir o problema e deixa para o usuário final descobrir a causa.</p><p>Com o AdonisJs nós tagamos todas as exceções com um único <em>código de erro</em> e você pode se referir à documentação do dado código de erro para entender a causa da exceção.</p><p>Além disso, também oferecemos um ótimo pacote npm chamado <a href="https://npmjs.org/package/node-exceptions" target="_blank" rel="noreferrer">node-exceptions</a> para configurar classes de exceção específicas da aplicação para lançar exceções pessoais e significativas.</p><h2 id="codigos-de-erro" tabindex="-1">Códigos de Erro <a class="header-anchor" href="#codigos-de-erro" aria-label="Permalink to &quot;Códigos de Erro&quot;">​</a></h2><p>Abaixo está a lista de códigos de erro lançados pelo núcleo do Adonis. Você pode referenciá-los para entender o contexto da exceção.</p><p>Todas as exceções são divididas em múltiplas categorias como <em>Geral</em>, <em>Banco de Dados</em>, <em>Redis</em>, etc.</p><h3 id="general" tabindex="-1">General <a class="header-anchor" href="#general" aria-label="Permalink to &quot;General&quot;">​</a></h3><p>Exceções gerais são levantadas de qualquer parte do framework.</p><table><thead><tr><th>Código de Erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_MISSING_APPKEY</td><td>A chave de aplicativo é usada para criptografar cookies ou qualquer outro valor confidenciais. Esta exceção é lançada quando o &#39;appKey&#39; não está definido dentro do arquivo &#39;config/app.js&#39;, que se refere a um valor dentro do arquivo &#39;.env&#39;.</td></tr></tbody></table><p>Você pode usar um comando de as para gerar a chave do aplicativo para você. <code>./ace key:generate</code>.</p><table><thead><tr><th>Código de Erro</th><th>Descrição</th></tr></thead><tbody><tr><td>Não foi possível traduzir pois a entrada não é um JSON válido</td><td>Esta exceção é lançada quando uma função espera que o parâmetro seja uma string JSON válida, mas não consegue chamar o método <code>JSON.parse</code> nele.</td></tr></tbody></table><table><thead><tr><th>Código de Erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_MISSING_PARAMETER</td><td>A exceção mais frequentemente lançada quando um parâmetro esperado por um método não está sendo passado ou é indefinido.</td></tr><tr><td>E_INVALID_PARAMETER</td><td>Esta exceção é lançada quando o valor do parâmetro não está correto. Por exemplo, um método espera que &#39;idade&#39; seja um <em>Número</em>, mas em vez disso um <em>String</em> foi passado.</td></tr><tr><td>E_MISSING_CONFIG</td><td>Quando a configuração para uma determinada chave está ausente. A exceção é lançada pelos <em>provedores de serviço</em> quando eles estão tentando acessar a configuração e não conseguem encontrá-la dentro do diretório <code>config</code>.</td></tr><tr><td>Não foi possível traduzir porque o texto em inglês não foi fornecido.</td><td>Esta exceção é lançada quando um cliente está tentando acessar um método inexistente.</td></tr></tbody></table><h3 id="provedor-de-criptografia" tabindex="-1">Provedor de Criptografia <a class="header-anchor" href="#provedor-de-criptografia" aria-label="Permalink to &quot;Provedor de Criptografia&quot;">​</a></h3><p>Abaixo está a lista de exceções levantadas apenas pelo provedor <a href="/segurança/criptografia-e-hashing.html">Provedor de criptografia</a>.</p><table><thead><tr><th>Código de Erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_INVALID_ENCRPYTION_CIPHER</td><td>Esta exceção é lançada quando um cifrado não suportado é usado para criptografar/descriptografar um valor.</td></tr><tr><td>E_INVALID_ENCRYPTION_PAYLOAD</td><td>Esta exceção é lançada quando a carga passada para o método <code>encrypt</code> não é legível.</td></tr><tr><td>E_INVALID_ENCRYPTION_MAC</td><td>Esta exceção é lançada quando uma MAC de criptografia não suportada é definida para criptografar/descriptografar um valor.</td></tr></tbody></table><h3 id="formulario-fornecedor-de-rota" tabindex="-1">Formulário &amp; Fornecedor de Rota <a class="header-anchor" href="#formulario-fornecedor-de-rota" aria-label="Permalink to &quot;Formulário &amp; Fornecedor de Rota&quot;">​</a></h3><p>Abaixo está a lista de todas as exceções levantadas apenas pelo [Formulário](&#39; / views / form-builder &#39;) ou o provedor de [Rotas](&#39; / getting-started / routing &#39;).</p><table><thead><tr><th>Código de Erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_MISSING_ROUTE</td><td>Esta exceção é lançada quando você está tentando referenciar uma rota inexistente dentro de suas visualizações. O local mais comum é dentro do construtor.</td></tr><tr><td>E_MISSING_ROUTE_ACTION</td><td>A exceção é lançada pelo <a href="/views/form-builder.html">formulário de construção</a> quando uma ação de controlador/rota não registrada é passada para o método &#39;abrir&#39;.</td></tr></tbody></table><h3 id="fornecedor-de-eventos" tabindex="-1">Fornecedor de eventos <a class="header-anchor" href="#fornecedor-de-eventos" aria-label="Permalink to &quot;Fornecedor de eventos&quot;">​</a></h3><table><thead><tr><th>Código de Erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_MISSING_Named_Event</td><td>O provedor de eventos lançará esta exceção quando você estiver tentando remover um ouvinte não registrado.</td></tr></tbody></table><h3 id="provedor-de-sessao" tabindex="-1">Provedor de Sessão <a class="header-anchor" href="#provedor-de-sessao" aria-label="Permalink to &quot;Provedor de Sessão&quot;">​</a></h3><table><thead><tr><th>Código de Erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_INVALID_SESSION_DRIVER</td><td>Exceção é lançada quando o driver de sessão definido dentro do arquivo <code>config/session.js</code> não existe.</td></tr></tbody></table><h3 id="middleware-provider" tabindex="-1">Middleware Provider <a class="header-anchor" href="#middleware-provider" aria-label="Permalink to &quot;Middleware Provider&quot;">​</a></h3><table><thead><tr><th>Código de Erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_MISSING_NamedMiddleware</td><td>Esta exceção é lançada quando um middleware nomeado não registrado é referenciado nas rotas.</td></tr></tbody></table><h3 id="provedor-de-banco-de-dados" tabindex="-1">Provedor de banco de dados <a class="header-anchor" href="#provedor-de-banco-de-dados" aria-label="Permalink to &quot;Provedor de banco de dados&quot;">​</a></h3><table><thead><tr><th>Código de Erro</th><th>Descrição</th></tr></thead><tbody><tr><td>Não foi possível traduzir a seguinte parte do texto: E_MISSING_MODEL_FACTORY.</td><td>Esta exceção é lançada quando você tenta acessar uma fábrica de modelo não registrada. Certifique-se de definir fábricas de modelos/esboços dentro do arquivo &quot;database/factory.js&quot;.</td></tr><tr><td>E_MISSING_DATABASE_FACTORY</td><td>Esta exceção é lançada quando você tenta acessar uma fábrica de banco de dados não registrada. Certifique-se de definir fábricas/planos de modelo dentro do arquivo &#39;database/factory.js&#39;.</td></tr><tr><td>E_MISSING_DATABASE_ROW</td><td>Esta exceção é lançada pelos métodos do modelo Lucid, como <em>findOrFail</em> e <em>findByOrFail</em>, quando não conseguir encontrar um registro com o valor dado.</td></tr><tr><td>E_INVALID_MODEL_STATE</td><td>Esta exceção é lançada quando você está tentando salvar um modelo vazio ou tentar atualizar uma instância de modelo excluído.</td></tr><tr><td>E_UNSAVED_MODEL_INSTANCE</td><td>Esta exceção é lançada quando você está tentando salvar uma relação em um modelo que ainda não foi salvo.</td></tr><tr><td>E_INVALID_RELATION_INSTANCE</td><td>Esta exceção é lançada quando você passa uma instância de modelo inválido para o método <code>save</code> da relação.</td></tr><tr><td>E_INVALID_RELATION_METHOD</td><td>Esta exceção é lançada quando você chama um método indefinido em uma instância de relacionamento. Por exemplo, o relacionamento &quot;HasOne&quot; não possui um método &#39;paginate&#39;.</td></tr><tr><td>E_MISSING_DATABASE_RELATION</td><td>Esta exceção é lançada quando você está tentando acessar uma relação que nunca foi definida.</td></tr><tr><td>E_LOCK_ON_MIGRATIONS</td><td>Esta exceção é lançada quando você tenta executar as migrações mais de uma vez em paralelo.</td></tr><tr><td>E_INVALID_SCHEMA_FILE</td><td>Esta exceção é lançada quando os arquivos <em>schema</em> dentro da pasta <code>database/migrations</code> não estão exportando uma classe ES2015.</td></tr><tr><td>E_UNSAFE_ENVIRONMENT</td><td>Esta exceção é lançada quando você está tentando executar operações inseguras no ambiente de produção. Por exemplo: Executando migrações em produção.</td></tr><tr><td>E_INVALID_MODEL_TRAIT</td><td>Esta exceção é lançada quando um modelo de traço não tem um método &#39;registro&#39; nele.</td></tr></tbody></table><h3 id="provedor-de-email" tabindex="-1">Provedor de Email <a class="header-anchor" href="#provedor-de-email" aria-label="Permalink to &quot;Provedor de Email&quot;">​</a></h3><table><thead><tr><th>Código de Erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_INVALID_MAIL_DRIVER</td><td>Esta exceção é lançada quando você está tentando acessar um driver de e-mail não registrado.</td></tr><tr><td>E-INVALID_MAIL_VIEW</td><td>Esta exceção é lançada quando você está tentando chamar o método <code>Mail.send</code> sem uma visão válida.</td></tr></tbody></table><h3 id="ioc-container" tabindex="-1">IoC Container <a class="header-anchor" href="#ioc-container" aria-label="Permalink to &quot;IoC Container&quot;">​</a></h3><table><thead><tr><th>Código de Erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_INVALID_IOC_MANAGER</td><td>Esta exceção é lançada quando você está tentando registrar um gerenciador no contêiner IoC sem o método &#39;extend&#39;.</td></tr><tr><td>E_INVALID_MAKE_STRING</td><td>Esta exceção é lançada quando uma string passada para <code>Ioc.makeFunc</code> está incorreta. As strings precisam ter nomes de classe e função separados por ponto (<code>.</code>). Por exemplo: <code>Ioc.makeFunc(&#39;UserController.store&#39;)</code></td></tr></tbody></table><h3 id="antl-provider" tabindex="-1">Antl Provider <a class="header-anchor" href="#antl-provider" aria-label="Permalink to &quot;Antl Provider&quot;">​</a></h3><table><thead><tr><th>Código de Erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_INVALID_ANTL_DRIVER</td><td>Exceção é lançada quando o driver antl definido no arquivo <code>config/antl.js</code> não existe.</td></tr></tbody></table><h3 id="ally-provedor-de-autenticacao-social" tabindex="-1">Ally (Provedor de Autenticação Social) <a class="header-anchor" href="#ally-provedor-de-autenticacao-social" aria-label="Permalink to &quot;Ally (Provedor de Autenticação Social)&quot;">​</a></h3><table><thead><tr><th>Código de Erro</th><th>Descrição</th></tr></thead><tbody><tr><td>E_OAUTH_TOKEN_EXCHANGE</td><td>Esta exceção é lançada quando não é possível trocar o token de acesso usando o código OAuth. Isso geralmente acontece dentro do retorno de chamada ao usar o método [getUser] / common-web-tools / social-auth.</td></tr><tr><td>E_INVALID_ALLY_DRIVER</td><td>Esta exceção é lançada quando o motorista aliado definido dentro do arquivo &quot;config/services.js&quot; não existe.</td></tr><tr><td>E_MISSING_OAUTH_CONFIG</td><td>Esta exceção é lançada quando não existe configuração de Ally para um determinado driver.</td></tr></tbody></table><h2 id="lendo-excecoes" tabindex="-1">Lendo exceções <a class="header-anchor" href="#lendo-excecoes" aria-label="Permalink to &quot;Lendo exceções&quot;">​</a></h2><p>É recomendado lançar uma exceção contextual, pois isso facilita a ação do usuário final sobre elas. O AdonisJs utiliza o <a href="https://npmjs.org/package/node-exceptions" target="_blank" rel="noreferrer">node-exception</a>, um módulo npm para estruturar exceções. Você pode saber mais sobre isso através da documentação.</p><h2 id="capturando-excecoes" tabindex="-1">Capturando Exceções <a class="header-anchor" href="#capturando-excecoes" aria-label="Permalink to &quot;Capturando Exceções&quot;">​</a></h2><p>As exceções podem ser capturadas envolvendo seu código dentro de um bloco try/catch ou você pode tratá-las globalmente escutando o evento &quot;erro&quot;.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/Listeners/Http.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleError</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ModelNotFoundException&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    yield</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sendView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;404&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;PasswordMisMatch&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Invalid credentials&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error.status).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error.message) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Com a ajuda de exceções personalizadas, é tão fácil pegá-las com seu <em>nome</em> e retornar uma resposta personalizada para cada tipo de exceção.</p><ol><li>Lidando com a exceção <em>ModelNotFoundException</em> lançada pelo método <code>findOrFail</code> do modelo Lucid e retornando uma visão de <em>404</em>.</li><li>Lidando com a exceção <em>PasswordMisMatch</em> lançada pelo provedor de autenticação e retornando um status <em>400</em>.</li><li>Tratamento genérico de exceções para todas as outras exceções.</li></ol>`,44),r=[d];function i(n,l,c,h,p,m){return o(),e("div",null,r)}const k=a(s,[["render",i]]);export{E as __pageData,k as default};
