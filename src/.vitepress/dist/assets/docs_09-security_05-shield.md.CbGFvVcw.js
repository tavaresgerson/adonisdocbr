import{_ as s,c as a,o as i,a4 as e}from"./chunks/framework.nQaBHiNx.js";const E=JSON.parse('{"title":"Shield Middleware","description":"","frontmatter":{},"headers":[],"relativePath":"docs/09-security/05-shield.md","filePath":"docs/09-security/05-shield.md"}'),t={name:"docs/09-security/05-shield.md"},n=e(`<h1 id="shield-middleware" tabindex="-1">Shield Middleware <a class="header-anchor" href="#shield-middleware" aria-label="Permalink to &quot;Shield Middleware&quot;">​</a></h1><p>Além de <a href="/security/cors.html">Cors</a> e <a href="/security/csrf-protection.html">CSRF</a>, o Adonis também previne seus aplicativos web contra outros ataques maliciosos como XSS, Sniffing de Conteúdo, Injeção de Script, etc. Todo novo aplicativo é pré-configurado para usar o middleware &#39;shield&#39;, que mantém seu site seguro.</p><blockquote><p>NOTE Não existe uma bala de prata para proteger completamente seus sites. O AdonisJS como um framework oferece várias maneiras de prevenir ataques comuns na web.</p></blockquote><h2 id="configuracao-instalacao" tabindex="-1">Configuração &amp; Instalação <a class="header-anchor" href="#configuracao-instalacao" aria-label="Permalink to &quot;Configuração &amp; Instalação&quot;">​</a></h2><p>Certifique-se de que o <em>shield</em> middleware seja adicionado à lista de middleware global dentro do arquivo <code>app/Http/kernel.js</code>.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/Http/kernel.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> globalMiddlewares</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;Adonis/Middleware/Shield&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p>O arquivo de configuração do escudo está disponível dentro do arquivo config/shield.js. Você é livre para configurá-lo conforme suas necessidades.</p><h2 id="politica-de-seguranca-de-conteudo" tabindex="-1">Política de Segurança de Conteúdo <a class="header-anchor" href="#politica-de-seguranca-de-conteudo" aria-label="Permalink to &quot;Política de Segurança de Conteúdo&quot;">​</a></h2><p>A Política de Segurança de Conteúdo (CSP) ajuda a definir as fontes confiáveis para carregar e executar scripts, estilos, fontes e outros recursos.</p><p>É uma boa prática ser estrito ao permitir a execução de scripts de diferentes fontes. Você deve ler este interessante artigo por <a href="http://www.html5rocks.com/pt-br/tutorials/security/content-security-policy" target="_blank" rel="noreferrer">HTML5 rocks</a>.</p><h3 id="configuracao" tabindex="-1">Configuração <a class="header-anchor" href="#configuracao" aria-label="Permalink to &quot;Configuração&quot;">​</a></h3><p>O bloco &#39;csp&#39; dentro do arquivo de configuração do escudo define a regra para a política de segurança de conteúdo.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">csp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  directives</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    defaultSrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;self&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://getcdn.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    scriptSrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;self&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@nonce&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    styleSrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://getbootstrap.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    imgSrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://dropbox.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  reportOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  setAllHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  disableAndroid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>| Chave | Valor | Descrição | | diretivas | Objeto | Diretivas ajuda você a definir políticas a serem aplicadas em diferentes tipos de recursos. Você pode obter a lista de todas as diretivas em <a href="http://content-security-policy.com/" target="_blank" rel="noreferrer">http://content-security-policy.com</a>. | | reportOnly | Boolean | Isso não irá parar a execução da sua página, em vez disso, retornará uma mensagem de aviso dizendo que algumas regras foram violadas. | | setAllHeaders | Boolean | O escudo define diferentes cabeçalhos HTTP para diferentes navegadores. Para desativar esse comportamento, você pode este valor como verdadeiro, e todos os cabeçalhos serão definidos. | | desativarAndroid | Boolean | Android é bugado com CSP você pode desativá-lo para Android no caso de você enfrentar qualquer problema. |</p><h3 id="suporte-de-navegador" tabindex="-1">Suporte de navegador <a class="header-anchor" href="#suporte-de-navegador" aria-label="Permalink to &quot;Suporte de navegador&quot;">​</a></h3><p>Quase todos os navegadores modernos suportam o CSP, mas aqui está a lista mais precisa de navegadores compatíveis <a href="http://caniuse.com/#feat=content-security-policy" target="_blank" rel="noreferrer">lista</a>.</p><h3 id="politica-de-seguranca-de-conteudo-via-meta-tags" tabindex="-1">Política de Segurança de Conteúdo via Meta Tags <a class="header-anchor" href="#politica-de-seguranca-de-conteudo-via-meta-tags" aria-label="Permalink to &quot;Política de Segurança de Conteúdo via Meta Tags&quot;">​</a></h3><p>O <code>shield</code> middleware automaticamente define os cabeçalhos HTTP necessários para o CSP funcionar, mas também fornece um auxiliar de visão para definir a tag meta.</p><div class="language-twig vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">twig</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{{ cspMeta }}</span></span></code></pre></div><p>Saída:</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">meta</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http-equiv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Content-Security-Policy&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h3 id="csp-nonce" tabindex="-1">CSP Nonce <a class="header-anchor" href="#csp-nonce" aria-label="Permalink to &quot;CSP Nonce&quot;">​</a></h3><p>Tags de script com código JavaScript inline são automaticamente confiáveis e executadas pelo navegador. Para interromper esse comportamento, você deve permitir apenas blocos de script inline confiáveis adicionando <code>@nonce</code> ao array <code>scriptSrc</code>.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">csp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  directives</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    scriptSrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;self&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@nonce&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Agora você tem que dizer ao navegador que seus blocos de script embutidos selecionados devem ser executados, e essa seleção é feita com a ajuda de uma visão global.</p><div class="language-twig vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">twig</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> nonce</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{{ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cspNonce</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> }}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h2 id="protecao-contra-malware" tabindex="-1">Proteção contra malware <a class="header-anchor" href="#protecao-contra-malware" aria-label="Permalink to &quot;Proteção contra malware&quot;">​</a></h2><p>A proteção contra malware ajuda a proteger seu site de ataques XSS, inserções indesejadas de iframe, sniffing de tipo de conteúdo e para impedir que o IE execute scripts não solicitados no contexto da sua página da web.</p><h3 id="xss" tabindex="-1">XSS <a class="header-anchor" href="#xss" aria-label="Permalink to &quot;XSS&quot;">​</a></h3><p>Faça uso da configuração abaixo definida para habilitar/desabilitar a proteção XSS. É feito por meio de um cabeçalho HTTP, que é definido como &#39;X-XSS-Protection: 1; mode=block&#39;</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xss</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  enableOnOldIE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="sem-cheiro" tabindex="-1">Sem cheiro <a class="header-anchor" href="#sem-cheiro" aria-label="Permalink to &quot;Sem cheiro&quot;">​</a></h3><p>A maioria dos navegadores modernos tentará detectar o tipo de conteúdo de uma solicitação, analisando seu conteúdo. Isso significa que um arquivo com a extensão <em>.txt</em> pode ser executado como um arquivo JavaScript se contiver código JavaScript. Para desativar esse comportamento, defina &#39;nosniff=false&#39;.</p><p>Abaixo a configuração irá definir o valor do cabeçalho <code>X-Content-Type-Options</code> para <em>nosniff</em>.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  nosniff</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="nao-aberto" tabindex="-1">Não aberto <a class="header-anchor" href="#nao-aberto" aria-label="Permalink to &quot;Não aberto&quot;">​</a></h3><p>Esta configuração impedirá que o Internet Explorer execute scripts desconhecidos no contexto do seu site. A configuração abaixo definirá o valor de X-Download-Options para <em>noopen</em>.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  noopen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="xframe" tabindex="-1">XFrame <a class="header-anchor" href="#xframe" aria-label="Permalink to &quot;XFrame&quot;">​</a></h3><p>A opção xframe no arquivo config/shield.js facilita o controle do comportamento de incorporação do seu site dentro de um iFrame. Você pode escolher entre &#39;DENY&#39;, &#39;ALLOW&#39; ou &#39;ALLOW-FROM <a href="http://mywebsite.com" target="_blank" rel="noreferrer">http://mywebsite.com</a>&#39;.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  xframe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DENY&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>`,41),o=[n];function l(p,r,h,d,c,k){return i(),a("div",null,o)}const u=s(t,[["render",l]]);export{E as __pageData,u as default};
